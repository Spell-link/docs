---


---

<h1 id="duffel-travel-api-integration-guide">Duffel Travel API Integration Guide</h1>
<h2 id="enterprise-documentation-for-travel-agency-platform">Enterprise Documentation for Travel Agency Platform</h2>
<p><strong>Document Version:</strong> 1.0</p>
<p><strong>Last Updated:</strong> February 2026</p>
<p><strong>Classification:</strong> Technical Integration Guide</p>
<p><strong>Target Platform:</strong> Web + Mobile Travel Agency System</p>
<hr>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#1-introduction-to-duffel">Introduction to Duffel</a></li>
</ol>
<ul>
<li><a href="#15-booking-pia-flights-via-duffel-step-by-step-procedure">1.5 Booking PIA Flights via Duffel</a></li>
</ul>
<ol start="2">
<li>
<p><a href="#2-use-cases-for-a-travel-agency-platform">Use Cases for a Travel Agency Platform</a></p>
</li>
<li>
<p><a href="#3-duffel-capabilities-overview">Duffel Capabilities Overview</a></p>
</li>
<li>
<p><a href="#4-basic-plan-vs-enterprise-plan">Basic Plan vs Enterprise Plan</a></p>
</li>
<li>
<p><a href="#5-system-architecture">System Architecture</a></p>
</li>
<li>
<p><a href="#6-complete-booking-flow-end-to-end">Complete Booking Flow (End-to-End)</a></p>
</li>
<li>
<p><a href="#7-step-by-step-integration-guide">Step-by-Step Integration Guide</a></p>
</li>
<li>
<p><a href="#8-data-models--database-design-suggestions">Data Models &amp; Database Design</a></p>
</li>
<li>
<p><a href="#9-security-best-practices">Security Best Practices</a></p>
</li>
<li>
<p><a href="#10-error-handling--edge-cases">Error Handling &amp; Edge Cases</a></p>
</li>
<li>
<p><a href="#11-testing-strategy">Testing Strategy</a></p>
</li>
<li>
<p><a href="#12-deployment--production-readiness">Deployment &amp; Production Readiness</a></p>
</li>
<li>
<p><a href="#13-realistic-development-timeline">Realistic Development Timeline</a></p>
</li>
<li>
<p><a href="#14-scaling-considerations">Scaling Considerations</a></p>
</li>
<li>
<p><a href="#15-cost-factors--business-considerations">Cost Factors &amp; Business Considerations</a></p>
</li>
<li>
<p><a href="#16-future-enhancements">Future Enhancements</a></p>
</li>
<li>
<p><a href="#17-final-integration-checklist">Final Integration Checklist</a></p>
</li>
</ol>
<hr>
<h2 id="introduction-to-duffel">1. Introduction to Duffel</h2>
<h3 id="what-duffel-is">1.1 What Duffel Is</h3>
<ul>
<li></li>
</ul>
<p><em>Duffel</em>* is a modern, API-first travel technology platform that provides direct access to airline flight content for developers building travel applications. It operates as a <strong>travel aggregator and orchestration layer</strong> that abstracts the complexity of airline distribution systems into a single, RESTful API.</p>
<p>| Attribute | Description |</p>
<p>|-----------|-------------|</p>
<p>| <strong>Type</strong> | Flight aggregation API / Travel Commerce Platform |</p>
<p>| <strong>Architecture</strong> | RESTful JSON API |</p>
<p>| <strong>Primary Use</strong> | Flight search, booking, order management, ancillaries |</p>
<p>| <strong>Deployment</strong> | Cloud-hosted (SaaS) |</p>
<p>| <strong>Integration Model</strong> | API-key authenticated HTTPS requests |</p>
<h3 id="duffel-vs.-gds-amadeus-sabre-travelport">1.2 Duffel vs. GDS (Amadeus, Sabre, Travelport)</h3>
<p>| Dimension | <strong>Duffel</strong> | <strong>Traditional GDS</strong> |</p>
<p>|-----------|------------|----------------------|</p>
<p>| <strong>Distribution Model</strong> | NDC + Managed Content aggregation | EDIFACT-based legacy distribution |</p>
<p>| <strong>Accreditation</strong> | No IATA/ARC license required; Duffel handles ticketing authority | Requires IATA/ARC accreditation; lengthy airline contracts |</p>
<p>| <strong>Integration Time</strong> | Hours to days | Months to quarters |</p>
<p>| <strong>Documentation</strong> | Developer-friendly, OpenAPI specs | Complex PNR, cryptic codes, travel-industry expertise required |</p>
<p>| <strong>API Design</strong> | REST, JSON, idempotent operations | Proprietary protocols (Pseudo-City Codes, Scribe) |</p>
<p>| <strong>Upfront Costs</strong> | Zero; pay-per-use | Licensing fees, setup fees, monthly minimums |</p>
<p>| <strong>Airline Content</strong> | NDC-native airlines + managed content; rich ancillaries | Limited NDC adoption; legacy EDIFACT content |</p>
<p>| <strong>Surcharges</strong> | No distribution surcharges on NDC content | GDS segment fees ($3–6+ per segment) |</p>
<p>| <strong>Support</strong> | Email/phone, priority for Enterprise | Vendor-specific; often tied to support contracts |</p>
<h4 id="gds-explained-amadeus-sabre-and-travelport">1.2.1 GDS Explained: Amadeus, Sabre, and Travelport</h4>
<p>A <strong>Global Distribution System (GDS)</strong> is a central computerized network that aggregates airline inventory, hotel rooms, car rentals, and rail content. It connects travel suppliers (airlines, hotels) with travel sellers (OTAs, travel agencies, corporate travel managers) for real-time search, pricing, and booking. Amadeus, Sabre, and Travelport control over 90% of the global travel distribution market.</p>
<p><strong>Amadeus</strong></p>
<p>| Aspect | Details |</p>
<p>|--------|---------|</p>
<p>| <strong>What it is</strong> | A GDS that aggregates airline inventory, hotel rooms, car rentals, and rail content from suppliers worldwide |</p>
<p>| <strong>Founded</strong> | 1987 (headquarters: Madrid, Spain; core database: Erding, Germany) |</p>
<p>| <strong>Role</strong> | Connects travel suppliers with travel sellers for real-time search and booking; also provides airline IT (Altéa PSS) |</p>
<p>| <strong>Technology</strong> | EDIFACT-based legacy protocols, PNR (Passenger Name Record) system, pseudo-city codes |</p>
<p>| <strong>Scale</strong> | ~190 markets; powers major airlines (e.g., Southwest, Air Canada, SriLankan Airlines) for reservations |</p>
<p>| <strong>Accreditation</strong> | Requires IATA/ARC accreditation; multi-month airline contracts; segment fees per booking |</p>
<p><strong>Sabre</strong></p>
<p>| Aspect | Details |</p>
<p>|--------|---------|</p>
<p>| <strong>What it is</strong> | One of the original GDS platforms; the first computerized airline reservation system |</p>
<p>| <strong>Origin</strong> | Developed by American Airlines and IBM in the 1960s (Semi-Automated Business Research Environment) |</p>
<p>| <strong>Role</strong> | Same as GDS generally: real-time inventory, search, booking, pricing for flights, hotels, and cars |</p>
<p>| <strong>Technology</strong> | Proprietary protocols (Scribe), PNR, cryptic codes, travel-industry-specific systems |</p>
<p>| <strong>Scale</strong> | One of the three largest GDSs; processes billions of transactions annually |</p>
<p>| <strong>Users</strong> | Travel agents, airlines, OTAs via certified connectivity |</p>
<p><strong>Travelport</strong><br>
| Aspect | Details |</p>
<p>|--------|---------|</p>
<p>| <strong>What it is</strong> | A GDS that consolidated three legacy systems under one brand |</p>
<p>| <strong>Legacy systems</strong> | <strong>Apollo</strong> (US-focused), <strong>Galileo</strong> (European/UK), <strong>Worldspan</strong> (global) |</p>
<p>| <strong>Role</strong> | Same core GDS function: aggregates supplier content for travel sellers |</p>
<p>| <strong>Modern platform</strong> | Travelport+ — multi-source content including NDC for NDC-capable airlines |</p>
<p>| <strong>Technology</strong> | Legacy EDIFACT/PNR; JSON APIs for NDC content (April 2023+) |</p>
<p>| <strong>Scale</strong> | Strong international coverage; one of the top three GDS providers |</p>
<p><strong>Why GDS vs Duffel Matters</strong></p>
<pre class=" language-mermaid"><svg id="mermaid-svg-w29mZR5sH4Zjy91N" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="724.75" style="max-width: 388.4508056640625px;" viewBox="0 0 388.4508056640625 724.75"><style>#mermaid-svg-w29mZR5sH4Zjy91N{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-w29mZR5sH4Zjy91N .error-icon{fill:#552222;}#mermaid-svg-w29mZR5sH4Zjy91N .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-w29mZR5sH4Zjy91N .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-w29mZR5sH4Zjy91N .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-w29mZR5sH4Zjy91N .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-w29mZR5sH4Zjy91N .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-w29mZR5sH4Zjy91N .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-w29mZR5sH4Zjy91N .marker{fill:#666;stroke:#666;}#mermaid-svg-w29mZR5sH4Zjy91N .marker.cross{stroke:#666;}#mermaid-svg-w29mZR5sH4Zjy91N svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-w29mZR5sH4Zjy91N .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-svg-w29mZR5sH4Zjy91N .cluster-label text{fill:#333;}#mermaid-svg-w29mZR5sH4Zjy91N .cluster-label span{color:#333;}#mermaid-svg-w29mZR5sH4Zjy91N .label text,#mermaid-svg-w29mZR5sH4Zjy91N span{fill:#000000;color:#000000;}#mermaid-svg-w29mZR5sH4Zjy91N .node rect,#mermaid-svg-w29mZR5sH4Zjy91N .node circle,#mermaid-svg-w29mZR5sH4Zjy91N .node ellipse,#mermaid-svg-w29mZR5sH4Zjy91N .node polygon,#mermaid-svg-w29mZR5sH4Zjy91N .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-svg-w29mZR5sH4Zjy91N .node .label{text-align:center;}#mermaid-svg-w29mZR5sH4Zjy91N .node.clickable{cursor:pointer;}#mermaid-svg-w29mZR5sH4Zjy91N .arrowheadPath{fill:#333333;}#mermaid-svg-w29mZR5sH4Zjy91N .edgePath .path{stroke:#666;stroke-width:1.5px;}#mermaid-svg-w29mZR5sH4Zjy91N .flowchart-link{stroke:#666;fill:none;}#mermaid-svg-w29mZR5sH4Zjy91N .edgeLabel{background-color:white;text-align:center;}#mermaid-svg-w29mZR5sH4Zjy91N .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-svg-w29mZR5sH4Zjy91N .cluster rect{fill:hsl(210,66.6666666667%,95%);stroke:#26a;stroke-width:1px;}#mermaid-svg-w29mZR5sH4Zjy91N .cluster text{fill:#333;}#mermaid-svg-w29mZR5sH4Zjy91N .cluster span{color:#333;}#mermaid-svg-w29mZR5sH4Zjy91N div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160,0%,93.3333333333%);border:1px solid #26a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-w29mZR5sH4Zjy91N:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-w29mZR5sH4Zjy91N flowchart-v2{fill:apa;}</style><g transform="translate(0, 0)"><marker id="flowchart-pointEnd" class="marker flowchart" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-pointStart" class="marker flowchart" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-circleEnd" class="marker flowchart" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-circleStart" class="marker flowchart" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-crossEnd" class="marker cross flowchart" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-crossStart" class="marker cross flowchart" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M38.464700582732746,655.03125L33.38725048561062,660.4045138888889C28.309800388488497,665.7777777777778,18.15490019424425,676.5243055555555,13.077450097122124,683.2408854166666C8,689.9574652777778,8,692.6440972222222,34.744791666666664,695.3307291666666C61.489583333333336,698.017361111111,114.97916666666667,700.7039930555555,168.46875,700.7039930555555C221.95833333333334,700.7039930555555,275.4479166666667,698.017361111111,302.1927083333333,695.3307291666666C328.9375,692.6440972222222,328.9375,689.9574652777778,323.86004990287785,683.2408854166666C318.78259980575575,676.5243055555555,308.6276996115115,665.7777777777778,303.55024951438935,660.4045138888889L298.47279941726725,655.03125" id="L-GDS-GDS" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-GDS LE-GDS" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M56.04119742945869,283.15625L51.65021660788224,288.5295138888889C47.259235786305794,293.90277777777777,38.4772741431529,304.6493055555556,34.08629332157645,311.3658854166667C29.6953125,318.08246527777777,29.6953125,320.76909722222223,52.82421875,323.4557291666667C75.953125,326.1423611111111,122.2109375,328.82899305555554,168.46875,328.8289930555555C214.7265625,328.82899305555554,260.984375,326.1423611111111,284.11328125,323.4557291666667C307.2421875,320.76909722222223,307.2421875,318.08246527777777,302.8512066784236,311.3658854166667C298.4602258568471,304.6493055555556,289.6782642136942,293.90277777777777,285.2872833921178,288.5295138888889L280.8963025705413,283.15625" id="L-DuffelMod-DuffelMod" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-DuffelMod LE-DuffelMod" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(168.46875, 703.390625)"><g class="label" transform="translate(-70.4609375, -13.359375)"><foreignObject width="140.921875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">Months to integrate</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(168.46875, 331.515625)"><g class="label" transform="translate(-48.375, -13.359375)"><foreignObject width="96.75" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">Hours to days</span></div></foreignObject></g></g></g><g class="nodes"><g class="root" transform="translate(21.6953125, 0)"><g class="clusters"><g class="cluster default" id="DuffelMod"><rect style="" rx="0" ry="0" x="8" y="8" width="277.546875" height="275.15625"></rect><g class="cluster-label" transform="translate(90.3046875, 13)"><foreignObject width="112.9375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Duffel (Modern)</span></div></foreignObject></g></g></g><g class="edgePaths"><path d="M146.7734375,74.71875L146.7734375,78.88541666666667C146.7734375,83.05208333333333,146.7734375,91.38541666666667,146.7734375,99.71875C146.7734375,108.05208333333333,146.7734375,116.38541666666667,146.7734375,120.55208333333333L146.7734375,124.71875" id="L-D1-D2" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-D1 LE-D2" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M146.7734375,166.4375L146.7734375,170.60416666666666C146.7734375,174.77083333333334,146.7734375,183.10416666666666,146.7734375,191.4375C146.7734375,199.77083333333334,146.7734375,208.10416666666666,146.7734375,212.27083333333334L146.7734375,216.4375" id="L-D2-D3" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-D2 LE-D3" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default default" id="flowchart-D2-1065" transform="translate(146.7734375, 145.578125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-60.6640625" y="-20.859375" width="121.328125" height="41.71875"></rect><g class="label" style="" transform="translate(-53.1640625, -13.359375)"><foreignObject width="106.328125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">REST/JSON API</span></div></foreignObject></g></g><g class="node default default" id="flowchart-D1-1064" transform="translate(146.7734375, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-38.5234375" y="-20.859375" width="77.046875" height="41.71875"></rect><g class="label" style="" transform="translate(-31.0234375, -13.359375)"><foreignObject width="62.046875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Your App</span></div></foreignObject></g></g><g class="node default default" id="flowchart-D3-1067" transform="translate(146.7734375, 237.296875)"><rect class="basic label-container" style="" rx="0" ry="0" x="-103.7734375" y="-20.859375" width="207.546875" height="41.71875"></rect><g class="label" style="" transform="translate(-96.2734375, -13.359375)"><foreignObject width="192.546875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">NDC plus Managed Content</span></div></foreignObject></g></g></g></g><g class="root" transform="translate(0, 371.875)"><g class="clusters"><g class="cluster default" id="GDS"><rect style="" rx="0" ry="0" x="8" y="8" width="212.984375" height="275.15625"></rect><g class="cluster-label" transform="translate(-45.9765625, 13)"><foreignObject width="320.9375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Traditional GDS (Amadeus/Sabre/Travelport)</span></div></foreignObject></g></g></g><g class="edgePaths"><path d="M114.4921875,74.71875L114.4921875,78.88541666666667C114.4921875,83.05208333333333,114.4921875,91.38541666666667,114.4921875,99.71875C114.4921875,108.05208333333333,114.4921875,116.38541666666667,114.4921875,120.55208333333333L114.4921875,124.71875" id="L-A1-G1" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-A1 LE-G1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M114.4921875,166.4375L114.4921875,170.60416666666666C114.4921875,174.77083333333334,114.4921875,183.10416666666666,114.4921875,191.4375C114.4921875,199.77083333333334,114.4921875,208.10416666666666,114.4921875,212.27083333333334L114.4921875,216.4375" id="L-G1-A2" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-G1 LE-A2" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default default" id="flowchart-G1-1061" transform="translate(114.4921875, 145.578125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-71.4921875" y="-20.859375" width="142.984375" height="41.71875"></rect><g class="label" style="" transform="translate(-63.9921875, -13.359375)"><foreignObject width="127.984375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">EDIFACT Protocols</span></div></foreignObject></g></g><g class="node default default" id="flowchart-A1-1060" transform="translate(114.4921875, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-56.5625" y="-20.859375" width="113.125" height="41.71875"></rect><g class="label" style="" transform="translate(-49.0625, -13.359375)"><foreignObject width="98.125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Travel Agency</span></div></foreignObject></g></g><g class="node default default" id="flowchart-A2-1063" transform="translate(114.4921875, 237.296875)"><rect class="basic label-container" style="" rx="0" ry="0" x="-61.078125" y="-20.859375" width="122.15625" height="41.71875"></rect><g class="label" style="" transform="translate(-53.578125, -13.359375)"><foreignObject width="107.15625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Airlines/Hotels</span></div></foreignObject></g></g></g></g></g></g></g></svg></pre>
<ul>
<li>
<p><strong>GDS</strong>: Requires IATA/ARC accreditation, per-segment fees, complex PNR handling, and multi-month integration.</p>
</li>
<li>
<p><strong>Duffel</strong>: No accreditation needed; single API; NDC + managed content; pay-per-order.</p>
</li>
</ul>
<h3 id="ndc-new-distribution-capability-explained">1.3 NDC (New Distribution Capability) Explained</h3>
<p><strong>NDC</strong> is an IATA standard for distributing airline products using XML-based messaging. It enables:</p>
<ul>
<li>
<p><strong>Direct airline connectivity</strong> without GDS middlemen for NDC-enabled carriers</p>
</li>
<li>
<p><strong>Rich content</strong>: branded fares, ancillaries, dynamic pricing, personalization</p>
</li>
<li>
<p><strong>Reduced distribution costs</strong>: airlines avoid GDS segment fees</p>
</li>
<li>
<p><strong>Retail-style offer/order model</strong>: search → offer → order (vs. legacy PNR flow)</p>
</li>
<li>
<p><strong>XML-based messaging</strong> between airlines and sellers (abstracted by Duffel into REST/JSON)</p>
</li>
</ul>
<p>Duffel integrates multiple airlines’ NDC APIs and standardizes them into a single API, so you receive airline content without managing individual NDC connections.</p>
<h3 id="why-modern-agencies-use-duffel">1.4 Why Modern Agencies Use Duffel</h3>
<ol>
<li>
<p><strong>Rapid go-to-market</strong>: No accreditation process; start building immediately.</p>
</li>
<li>
<p><strong>Unified API</strong>: One integration for 30+ NDC airlines and managed content.</p>
</li>
<li>
<p><strong>Transparent pricing</strong>: Pay-per-order; no hidden fees or surcharges on NDC.</p>
</li>
<li>
<p><strong>Modern developer experience</strong>: REST, OpenAPI, clear docs, test sandbox.</p>
</li>
<li>
<p><strong>Rich ancillary support</strong>: Bags, seats, meals, upgrades via the same API.</p>
</li>
<li>
<p><strong>Reduced operational overhead</strong>: No ticketing desk, no GDS training.</p>
</li>
</ol>
<h3 id="booking-pia-flights-via-duffel-step-by-step-procedure">1.5 Booking PIA Flights via Duffel: Step-by-Step Procedure</h3>
<p>This section describes how to book flights on <strong>PIA (Pakistan International Airlines)</strong> from Lahore to Karachi or Lahore to UAE using the Duffel API. PIA is supported on Duffel; you can search, book, and sell PIA flights alongside 300+ other airlines through the same integration.</p>
<h4 id="iata-airport-codes-for-pia-routes">IATA Airport Codes for PIA Routes</h4>
<p>| Route | Origin Airport | Destination Airport | IATA Codes |</p>
<p>|-------|----------------|---------------------|------------|</p>
<p>| Lahore → Karachi | Allama Iqbal International | Jinnah International | <strong>LHE</strong> → <strong>KHI</strong> |</p>
<p>| Lahore → Dubai | Allama Iqbal International | Dubai International | <strong>LHE</strong> → <strong>DXB</strong> |</p>
<p>| Lahore → Abu Dhabi | Allama Iqbal International | Abu Dhabi International | <strong>LHE</strong> → <strong>AUH</strong> |</p>
<h4 id="end-to-end-booking-procedure">End-to-End Booking Procedure</h4>
<pre class=" language-mermaid"><svg id="mermaid-svg-Trm48JpYdYSfEzzb" width="100%" xmlns="http://www.w3.org/2000/svg" height="785" style="max-width: 1150px;" viewBox="-50 -10 1150 785"><style>#mermaid-svg-Trm48JpYdYSfEzzb{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-Trm48JpYdYSfEzzb .error-icon{fill:#552222;}#mermaid-svg-Trm48JpYdYSfEzzb .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-Trm48JpYdYSfEzzb .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-Trm48JpYdYSfEzzb .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-Trm48JpYdYSfEzzb .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-Trm48JpYdYSfEzzb .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-Trm48JpYdYSfEzzb .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-Trm48JpYdYSfEzzb .marker{fill:#666;stroke:#666;}#mermaid-svg-Trm48JpYdYSfEzzb .marker.cross{stroke:#666;}#mermaid-svg-Trm48JpYdYSfEzzb svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-Trm48JpYdYSfEzzb .actor{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-Trm48JpYdYSfEzzb text.actor > tspan{fill:#333;stroke:none;}#mermaid-svg-Trm48JpYdYSfEzzb .actor-line{stroke:#666;}#mermaid-svg-Trm48JpYdYSfEzzb .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-svg-Trm48JpYdYSfEzzb .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-svg-Trm48JpYdYSfEzzb #arrowhead path{fill:#333;stroke:#333;}#mermaid-svg-Trm48JpYdYSfEzzb .sequenceNumber{fill:white;}#mermaid-svg-Trm48JpYdYSfEzzb #sequencenumber{fill:#333;}#mermaid-svg-Trm48JpYdYSfEzzb #crosshead path{fill:#333;stroke:#333;}#mermaid-svg-Trm48JpYdYSfEzzb .messageText{fill:#333;stroke:#333;}#mermaid-svg-Trm48JpYdYSfEzzb .labelBox{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-Trm48JpYdYSfEzzb .labelText,#mermaid-svg-Trm48JpYdYSfEzzb .labelText > tspan{fill:#333;stroke:none;}#mermaid-svg-Trm48JpYdYSfEzzb .loopText,#mermaid-svg-Trm48JpYdYSfEzzb .loopText > tspan{fill:#333;stroke:none;}#mermaid-svg-Trm48JpYdYSfEzzb .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(0,0%,83%);fill:hsl(0,0%,83%);}#mermaid-svg-Trm48JpYdYSfEzzb .note{stroke:hsl(60,100%,23.3333333333%);fill:#ffa;}#mermaid-svg-Trm48JpYdYSfEzzb .noteText,#mermaid-svg-Trm48JpYdYSfEzzb .noteText > tspan{fill:#333;stroke:none;}#mermaid-svg-Trm48JpYdYSfEzzb .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-svg-Trm48JpYdYSfEzzb .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-svg-Trm48JpYdYSfEzzb .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-svg-Trm48JpYdYSfEzzb:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-Trm48JpYdYSfEzzb sequence{fill:apa;}</style><g></g><g><line id="actor59" x1="75" y1="5" x2="75" y2="774" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">User</tspan></text></g><g><line id="actor60" x1="442" y1="5" x2="442" y2="774" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="367" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="442" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="442" dy="0">YourApp</tspan></text></g><g><line id="actor61" x1="775" y1="5" x2="775" y2="774" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="700" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="775" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="775" dy="0">Duffel</tspan></text></g><g><line id="actor62" x1="975" y1="5" x2="975" y2="774" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="900" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="975" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="975" dy="0">Payment</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="259" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">1. Search (LHE to KHI or DXB, dates, pax)</text><line x1="75" y1="113" x2="442" y2="113" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="609" y="128" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">POST /air/offer_requests</text><line x1="442" y1="161" x2="775" y2="161" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="609" y="176" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">offer_request_id</text><line x1="775" y1="209" x2="442" y2="209" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="609" y="224" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">GET /air/offers?offer_request_id=...</text><line x1="442" y1="257" x2="775" y2="257" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="609" y="272" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Offers including PIA if available</text><line x1="775" y1="305" x2="442" y2="305" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="259" y="320" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">2. Display offers</text><line x1="442" y1="353" x2="75" y2="353" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="259" y="368" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">3. Select offer</text><line x1="75" y1="401" x2="442" y2="401" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="259" y="416" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">4. Enter passenger names and DOB</text><line x1="75" y1="449" x2="442" y2="449" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="709" y="464" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">5. Collect payment</text><line x1="442" y1="497" x2="975" y2="497" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="709" y="512" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Payment reference</text><line x1="975" y1="545" x2="442" y2="545" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="609" y="560" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">6. POST /air/orders</text><line x1="442" y1="593" x2="775" y2="593" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="609" y="608" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Order with PNR</text><line x1="775" y1="641" x2="442" y2="641" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="259" y="656" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">7. Send confirmation</text><line x1="442" y1="689" x2="75" y2="689" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><g><rect x="0" y="709" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="741.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">User</tspan></text></g><g><rect x="367" y="709" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="442" y="741.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="442" dy="0">YourApp</tspan></text></g><g><rect x="700" y="709" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="775" y="741.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="775" dy="0">Duffel</tspan></text></g><g><rect x="900" y="709" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="975" y="741.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="975" dy="0">Payment</tspan></text></g></svg></pre>
<h4 id="step-by-step-api-flow">Step-by-Step API Flow</h4>
<p><strong>Step 1 — Create offer request</strong></p>
<pre class=" language-json"><code class="prism  language-json">
POST <span class="token operator">/</span>air<span class="token operator">/</span>offer_requests

<span class="token punctuation">{</span>

<span class="token string">"slices"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>

<span class="token punctuation">{</span> <span class="token string">"origin"</span><span class="token punctuation">:</span> <span class="token string">"LHE"</span><span class="token punctuation">,</span> <span class="token string">"destination"</span><span class="token punctuation">:</span> <span class="token string">"KHI"</span><span class="token punctuation">,</span> <span class="token string">"departure_date"</span><span class="token punctuation">:</span> <span class="token string">"2026-03-15"</span> <span class="token punctuation">}</span>

<span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token string">"passengers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"adult"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token string">"cabin_class"</span><span class="token punctuation">:</span> <span class="token string">"economy"</span>

<span class="token punctuation">}</span>

</code></pre>
<ul>
<li>
<p><strong>LHE → KHI</strong>: One-way Lahore–Karachi.</p>
</li>
<li>
<p><strong>LHE → DXB</strong> or <strong>LHE → AUH</strong>: Lahore to Dubai or Abu Dhabi.</p>
</li>
<li>
<p><strong>Round-trip</strong>: Add a second slice with <code>origin: "KHI"</code>, <code>"DXB"</code>, or <code>"AUH"</code> and <code>destination: "LHE"</code>.</p>
</li>
</ul>
<p><strong>Step 2 — List offers</strong></p>
<pre><code>
GET /air/offers?offer_request_id={id}

</code></pre>
<p>Filter or sort by airline code <code>PK</code> (PIA) if you want PIA-only results. Offers typically expire in ~30 minutes.</p>
<p><strong>Step 3 — Validate and select offer</strong></p>
<ul>
<li>
<p>Use <code>offer_id</code> from the chosen offer.</p>
</li>
<li>
<p>Re-fetch or validate the offer before booking (check <code>expires_at</code>).</p>
</li>
</ul>
<p><strong>Step 4 — Create order</strong></p>
<pre class=" language-json"><code class="prism  language-json">
POST <span class="token operator">/</span>air<span class="token operator">/</span>orders

<span class="token punctuation">{</span>

<span class="token string">"selected_offers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"off_xxxx"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token string">"passengers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>

<span class="token punctuation">{</span>

<span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"pas_xxx"</span><span class="token punctuation">,</span>

<span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"mr"</span><span class="token punctuation">,</span>

<span class="token string">"given_name"</span><span class="token punctuation">:</span> <span class="token string">"Ahmed"</span><span class="token punctuation">,</span>

<span class="token string">"family_name"</span><span class="token punctuation">:</span> <span class="token string">"Khan"</span><span class="token punctuation">,</span>

<span class="token string">"born_on"</span><span class="token punctuation">:</span> <span class="token string">"1990-01-15"</span>

<span class="token punctuation">}</span>

<span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token string">"payments"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"balance"</span><span class="token punctuation">,</span> <span class="token string">"amount"</span><span class="token punctuation">:</span> <span class="token string">"XXX"</span><span class="token punctuation">,</span> <span class="token string">"currency"</span><span class="token punctuation">:</span> <span class="token string">"PKR"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>

<span class="token punctuation">}</span>

</code></pre>
<p><strong>Step 5 — Handle payment</strong></p>
<ul>
<li>
<p>Use Duffel Payment Intents (if supported for your region) or your own gateway; pass the payment reference to Duffel where applicable.</p>
</li>
<li>
<p>Use the <code>Idempotency-Key</code> header for retry safety.</p>
</li>
</ul>
<p><strong>Step 6 — Confirmation</strong></p>
<ul>
<li>
<p>Duffel returns an order with <code>booking_reference</code> (PNR).</p>
</li>
<li>
<p>Store and display it in your confirmation email or SMS.</p>
</li>
</ul>
<h4 id="important-notes-for-pia-routes">Important Notes for PIA Routes</h4>
<p>| Note | Details |</p>
<p>|------|---------|</p>
<p>| <strong>Managed content</strong> | PIA may be delivered via Duffel’s managed content; a 1% fee applies on Basic plan |</p>
<p>| <strong>Offer availability</strong> | Actual PIA availability depends on Duffel’s live inventory; not every search will return PIA |</p>
<p>| <strong>Currency</strong> | PKR or USD as per Duffel config; 2% FX fee on conversions |</p>
<p>| <strong>Testing</strong> | Use Duffel sandbox (<code>duffel_test_</code> token) with Duffel Airways for deterministic tests; PIA routes use live content in production |</p>
<hr>
<h2 id="use-cases-for-a-travel-agency-platform">2. Use Cases for a Travel Agency Platform</h2>
<h3 id="b2c-business-to-consumer-booking">2.1 B2C (Business-to-Consumer) Booking</h3>
<p>| Aspect | Description |</p>
<p>|--------|-------------|</p>
<p>| <strong>Users</strong> | End consumers (travelers) |</p>
<p>| <strong>Flow</strong> | Search → Compare → Book → Pay → Receive confirmation |</p>
<p>| <strong>Features</strong> | Search filters, price comparison, multi-passenger booking, payment gateway integration |</p>
<p>| <strong>Duffel Fit</strong> | Offers API (search), Orders API (book), Payments (via Payment Intents or balance) |</p>
<h3 id="b2b-agent-portal">2.2 B2B Agent Portal</h3>
<p>| Aspect | Description |</p>
<p>|--------|-------------|</p>
<p>| <strong>Users</strong> | Travel agents, sub-agents |</p>
<p>| <strong>Flow</strong> | Agent logs in → Searches on behalf of customer → Books → Applies markup/commission |</p>
<p>| <strong>Features</strong> | Agent authentication, commission tracking, markup rules, agency hierarchy |</p>
<p>| <strong>Duffel Fit</strong> | Same APIs; backend handles agent context, commission calculation, PNR visibility |</p>
<h3 id="corporate-travel">2.3 Corporate Travel</h3>
<p>| Aspect | Description |</p>
<p>|--------|-------------|</p>
<p>| <strong>Users</strong> | Corporate travelers, travel managers |</p>
<p>| <strong>Flow</strong> | Policy-compliant search → Approval workflow → Booking → Expense integration |</p>
<p>| <strong>Features</strong> | Policy rules, preferred airlines, approval flows, reporting |</p>
<p>| <strong>Duffel Fit</strong> | Offers API with filters; Orders API; reporting via order/booking data |</p>
<h3 id="ota-online-travel-agency-model">2.4 OTA (Online Travel Agency) Model</h3>
<p>| Aspect | Description |</p>
<p>|--------|-------------|</p>
<p>| <strong>Users</strong> | Consumers browsing a branded travel site |</p>
<p>| <strong>Flow</strong> | Meta-search-style UX → Aggregated results → Redirect or book on-site |</p>
<p>| <strong>Features</strong> | Comparison engines, SEO, affiliates, white-label |</p>
<p>| <strong>Duffel Fit</strong> | Offers API for flight content; optional Links product for deep links |</p>
<h3 id="meta-search-integration">2.5 Meta Search Integration</h3>
<p>| Aspect | Description |</p>
<p>|--------|-------------|</p>
<p>| <strong>Users</strong> | Users comparing prices across OTAs |</p>
<p>| <strong>Flow</strong> | User searches → Your API returns offers → User clicks through to book |</p>
<p>| <strong>Features</strong> | API for meta-search partners, CPA/CPC models |</p>
<p>| <strong>Duffel Fit</strong> | Offers API as flight data source; Links for monetization |</p>
<hr>
<h2 id="duffel-capabilities-overview">3. Duffel Capabilities Overview</h2>
<h3 id="offers-api-flight-search">3.1 Offers API (Flight Search)</h3>
<p>| Capability | Description |</p>
<p>|------------|-------------|</p>
<p>| <strong>Endpoint</strong> | <code>POST /air/offer_requests</code> (create) → <code>GET /air/offers</code> (list) |</p>
<p>| <strong>Input</strong> | Origin, destination, dates, passengers (count + type), cabin class |</p>
<p>| <strong>Output</strong> | Sorted offers with pricing, segments, conditions, ancillaries |</p>
<p>| <strong>Expiry</strong> | Offers typically expire within 30 minutes |</p>
<p>| <strong>Filters</strong> | Airlines, max connections, specific flights |</p>
<h3 id="orders-api-booking">3.2 Orders API (Booking)</h3>
<p>| Capability | Description |</p>
<p>|------------|-------------|</p>
<p>| <strong>Endpoint</strong> | <code>POST /air/orders</code> |</p>
<p>| <strong>Input</strong> | Offer ID, passengers (name, DOB), payment, optional services |</p>
<p>| <strong>Output</strong> | Order with PNR/booking reference, status, conditions |</p>
<p>| <strong>Actions</strong> | List, retrieve, update; check <code>available_actions</code> for cancel/change |</p>
<h3 id="payments">3.3 Payments</h3>
<p>| Type | Description |</p>
<p>|-----|-------------|</p>
<p>| <strong>Payment Intents</strong> | Duffel-hosted flow; PCI scope reduced |</p>
<p>| <strong>Balance</strong> | Pay from Duffel balance (e.g., from refunds, credits) |</p>
<p>| <strong>ACH/Bank</strong> | Supported for qualifying accounts |</p>
<p>| <strong>Currency</strong> | Multi-currency; 2% FX fee on conversions (per pricing) |</p>
<h3 id="seat-selection">3.4 Seat Selection</h3>
<p>| Capability | Description |</p>
<p>|------------|-------------|</p>
<p>| <strong>Endpoint</strong> | <code>GET /air/seat_maps</code> (by offer ID) |</p>
<p>| <strong>Constraint</strong> | One seat per passenger per segment; not double-bookable |</p>
<p>| <strong>Timing</strong> | Available before order creation only |</p>
<p>| <strong>Coverage</strong> | Not all airlines support seat maps |</p>
<h3 id="baggage-services">3.5 Baggage Services</h3>
<p>| Capability | Description |</p>
<p>|------------|-------------|</p>
<p>| <strong>Pre-booking</strong> | Included in offer; select at order creation |</p>
<p>| <strong>Post-booking</strong> | <code>GET /air/orders/{id}/available_services</code> → book services |</p>
<p>| <strong>Endpoint</strong> | <code>POST /air/order_services</code> with payment |</p>
<h3 id="order-changes">3.6 Order Changes</h3>
<p>| Capability | Description |</p>
<p>|------------|-------------|</p>
<p>| <strong>Endpoint</strong> | <code>POST /air/order_changes</code> (create change request) |</p>
<p>| <strong>Actions</strong> | Change dates, routes; subject to <code>available_actions</code> on order |</p>
<p>| <strong>Flow</strong> | Create change → Get quote (fare difference, penalties) → Confirm with payment |</p>
<p>| <strong>Support</strong> | Not all airlines support changes; check order conditions |</p>
<h3 id="cancellation--refunds">3.7 Cancellation &amp; Refunds</h3>
<p>| Capability | Description |</p>
<p>|------------|-------------|</p>
<p>| <strong>Quote</strong> | <code>POST /air/order_cancellations</code> → returns refund amount, currency, <code>refund_to</code> |</p>
<p>| <strong>Confirm</strong> | <code>POST /air/order_cancellations/{id}/actions/confirm</code> |</p>
<p>| <strong>Refund flow</strong> | Refund to Duffel balance first; you refund customer separately |</p>
<p>| <strong>Payment Intents</strong> | Refunds API for refunding customers who paid via Payment Intents |</p>
<h3 id="airline-content-coverage">3.8 Airline Content Coverage</h3>
<p>| Type | Description |</p>
<p>|-----|-------------|</p>
<p>| <strong>NDC</strong> | 30+ airlines with direct NDC connectivity |</p>
<p>| <strong>Managed Content</strong> | Duffel’s ticketing authority for additional carriers |</p>
<p>| <strong>Fee</strong> | Managed content: 1% of order value (Basic plan) |</p>
<h3 id="ancillary-services">3.9 Ancillary Services</h3>
<p>| Service | Availability |</p>
<p>|---------|--------------|</p>
<p>| Bags | Pre- and post-booking |</p>
<p>| Seats | Pre-booking (seat maps) |</p>
<p>| Meals | Via offer/order where supported |</p>
<p>| Lounge | Where airline provides |</p>
<p>| <strong>Fee</strong> | $2.00 per paid ancillary (Basic plan) |</p>
<h3 id="webhooks">3.10 Webhooks</h3>
<p>| Feature | Details |</p>
<p>|---------|---------|</p>
<p>| <strong>Events</strong> | <code>order.created</code>, <code>order.airline_initiated_change</code>, <code>payment.*</code> |</p>
<p>| <strong>Delivery</strong> | At least once; retries up to 72h with exponential backoff |</p>
<p>| <strong>Security</strong> | HTTPS; cryptographically signed payloads |</p>
<p>| <strong>Management</strong> | Duffel Dashboard |</p>
<h3 id="test-vs.-live-environments">3.11 Test vs. Live Environments</h3>
<p>| Environment | Base URL | Token Prefix | Purpose |</p>
<p>|-------------|----------|--------------|---------|</p>
<p>| <strong>Test (Sandbox)</strong> | <code>https://api.duffel.com</code> | <code>duffel_test_</code> | Development, QA |</p>
<p>| <strong>Live</strong> | <code>https://api.duffel.com</code> | Live token | Production |</p>
<p>| <strong>Test airline</strong> | Duffel Airways (fictional) | — | Deterministic test data |</p>
<hr>
<h2 id="basic-plan-vs-enterprise-plan">4. Basic Plan vs Enterprise Plan</h2>
<h3 id="basic-plan-pay-as-you-go">4.1 Basic Plan (Pay-As-You-Go)</h3>
<p>| Category | Details |</p>
<p>|----------|---------|</p>
<p>| <strong>Upfront cost</strong> | $0; no monthly minimum |</p>
<p>| <strong>Orders</strong> | $3.00 per confirmed order |</p>
<p>| <strong>Managed content</strong> | 1% of total order value |</p>
<p>| <strong>Ancillaries</strong> | $2.00 per paid ancillary |</p>
<p>| <strong>Search ratio</strong> | 1500:1 search-to-book included; excess: $0.005 per search |</p>
<p>| <strong>FX</strong> | 2% on currency conversions |</p>
<p>| <strong>Support</strong> | Email-based technical support |</p>
<p>| <strong>Sandbox</strong> | Full sandbox access |</p>
<p>| <strong>Airline coverage</strong> | Standard NDC + managed content |</p>
<p>| <strong>Accreditation</strong> | Duffel’s accreditation; no IATA/ARC required |</p>
<h3 id="enterprise-plan">4.2 Enterprise Plan</h3>
<p>| Category | Details |</p>
<p>|----------|---------|</p>
<p>| <strong>Pricing</strong> | Bespoke; volume discounts |</p>
<p>| <strong>Support</strong> | Dedicated technical support |</p>
<p>| <strong>SLA</strong> | Tailored availability/response SLAs |</p>
<p>| <strong>Limits</strong> | Higher rate limits; custom caps |</p>
<p>| <strong>Contracts</strong> | Custom terms and contracts |</p>
<p>| <strong>Reporting</strong> | Advanced analytics and reporting |</p>
<p>| <strong>Multi-tenant</strong> | Support for multi-brand/multi-tenant setups |</p>
<p>| <strong>Airline content</strong> | Negotiated airline content options |</p>
<p>| <strong>Accreditation</strong> | Option to use own IATA accreditation |</p>
<p>| <strong>Eligibility</strong> | Existing travel sellers; contact sales |</p>
<h3 id="plan-comparison-summary">4.3 Plan Comparison Summary</h3>
<pre class=" language-mermaid"><svg id="mermaid-svg-vfJfxcNV7D52h7PE" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="107.71875" style="max-width: 1295.859375px;" viewBox="0 0 1295.859375 107.71875"><style>#mermaid-svg-vfJfxcNV7D52h7PE{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-vfJfxcNV7D52h7PE .error-icon{fill:#552222;}#mermaid-svg-vfJfxcNV7D52h7PE .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-vfJfxcNV7D52h7PE .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-vfJfxcNV7D52h7PE .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-vfJfxcNV7D52h7PE .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-vfJfxcNV7D52h7PE .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-vfJfxcNV7D52h7PE .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-vfJfxcNV7D52h7PE .marker{fill:#666;stroke:#666;}#mermaid-svg-vfJfxcNV7D52h7PE .marker.cross{stroke:#666;}#mermaid-svg-vfJfxcNV7D52h7PE svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-vfJfxcNV7D52h7PE .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-svg-vfJfxcNV7D52h7PE .cluster-label text{fill:#333;}#mermaid-svg-vfJfxcNV7D52h7PE .cluster-label span{color:#333;}#mermaid-svg-vfJfxcNV7D52h7PE .label text,#mermaid-svg-vfJfxcNV7D52h7PE span{fill:#000000;color:#000000;}#mermaid-svg-vfJfxcNV7D52h7PE .node rect,#mermaid-svg-vfJfxcNV7D52h7PE .node circle,#mermaid-svg-vfJfxcNV7D52h7PE .node ellipse,#mermaid-svg-vfJfxcNV7D52h7PE .node polygon,#mermaid-svg-vfJfxcNV7D52h7PE .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-svg-vfJfxcNV7D52h7PE .node .label{text-align:center;}#mermaid-svg-vfJfxcNV7D52h7PE .node.clickable{cursor:pointer;}#mermaid-svg-vfJfxcNV7D52h7PE .arrowheadPath{fill:#333333;}#mermaid-svg-vfJfxcNV7D52h7PE .edgePath .path{stroke:#666;stroke-width:1.5px;}#mermaid-svg-vfJfxcNV7D52h7PE .flowchart-link{stroke:#666;fill:none;}#mermaid-svg-vfJfxcNV7D52h7PE .edgeLabel{background-color:white;text-align:center;}#mermaid-svg-vfJfxcNV7D52h7PE .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-svg-vfJfxcNV7D52h7PE .cluster rect{fill:hsl(210,66.6666666667%,95%);stroke:#26a;stroke-width:1px;}#mermaid-svg-vfJfxcNV7D52h7PE .cluster text{fill:#333;}#mermaid-svg-vfJfxcNV7D52h7PE .cluster span{color:#333;}#mermaid-svg-vfJfxcNV7D52h7PE div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160,0%,93.3333333333%);border:1px solid #26a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-vfJfxcNV7D52h7PE:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-vfJfxcNV7D52h7PE flowchart-v2{fill:apa;}</style><g transform="translate(0, 0)"><marker id="flowchart-pointEnd" class="marker flowchart" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-pointStart" class="marker flowchart" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-circleEnd" class="marker flowchart" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-circleStart" class="marker flowchart" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-crossEnd" class="marker cross flowchart" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-crossStart" class="marker cross flowchart" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M485.4375,53.859375L489.6041666666667,53.859375C493.7708333333333,53.859375,502.1041666666667,53.859375,510.4375,53.859375C518.7708333333334,53.859375,527.1041666666666,53.859375,531.2708333333334,53.859375L535.4375,53.859375" id="L-BASIC-ENTERPRISE" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-BASIC LE-ENTERPRISE" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="root" transform="translate(527.4375, 0)"><g class="clusters"><g class="cluster default" id="ENTERPRISE"><rect style="" rx="0" ry="0" x="8" y="8" width="752.421875" height="91.71875"></rect><g class="cluster-label" transform="translate(329.65625, 13)"><foreignObject width="109.109375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Enterprise Plan</span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g class="node default default" id="flowchart-E1-1086" transform="translate(116.4453125, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-73.4453125" y="-20.859375" width="146.890625" height="41.71875"></rect><g class="label" style="" transform="translate(-65.9453125, -13.359375)"><foreignObject width="131.890625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Negotiated Pricing</span></div></foreignObject></g></g><g class="node default default" id="flowchart-E2-1087" transform="translate(309.84375, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-69.953125" y="-20.859375" width="139.90625" height="41.71875"></rect><g class="label" style="" transform="translate(-62.453125, -13.359375)"><foreignObject width="124.90625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Volume Discounts</span></div></foreignObject></g></g><g class="node default default" id="flowchart-E3-1088" transform="translate(503.578125, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-73.78125" y="-20.859375" width="147.5625" height="41.71875"></rect><g class="label" style="" transform="translate(-66.28125, -13.359375)"><foreignObject width="132.5625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Dedicated Support</span></div></foreignObject></g></g><g class="node default default" id="flowchart-E4-1089" transform="translate(676.390625, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-49.03125" y="-20.859375" width="98.0625" height="41.71875"></rect><g class="label" style="" transform="translate(-41.53125, -13.359375)"><foreignObject width="83.0625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Custom SLA</span></div></foreignObject></g></g></g></g><g class="root" transform="translate(0, 0)"><g class="clusters"><g class="cluster default" id="BASIC"><rect style="" rx="0" ry="0" x="8" y="8" width="477.4375" height="91.71875"></rect><g class="cluster-label" transform="translate(210.703125, 13)"><foreignObject width="72.03125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Basic Plan</span></div></foreignObject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g class="node default default" id="flowchart-B1-1083" transform="translate(99.90625, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-56.90625" y="-20.859375" width="113.8125" height="41.71875"></rect><g class="label" style="" transform="translate(-49.40625, -13.359375)"><foreignObject width="98.8125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Pay-as-you-go</span></div></foreignObject></g></g><g class="node default default" id="flowchart-B2-1084" transform="translate(246.234375, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-39.421875" y="-20.859375" width="78.84375" height="41.71875"></rect><g class="label" style="" transform="translate(-31.921875, -13.359375)"><foreignObject width="63.84375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">$3/order</span></div></foreignObject></g></g><g class="node default default" id="flowchart-B3-1085" transform="translate(393.046875, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-57.390625" y="-20.859375" width="114.78125" height="41.71875"></rect><g class="label" style="" transform="translate(-49.890625, -13.359375)"><foreignObject width="99.78125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Email Support</span></div></foreignObject></g></g></g></g></g></g></g></svg></pre>
<h3 id="detailed-comparison-table">4.4 Detailed Comparison Table</h3>
<p>| Feature | Basic | Enterprise |</p>
<p>|---------|-------|------------|</p>
<p>| Order fee | $3.00/order | Negotiated |</p>
<p>| Managed content fee | 1% | Negotiated |</p>
<p>| Ancillary fee | $2.00/ancillary | Negotiated |</p>
<p>| Support | Email | Dedicated |</p>
<p>| SLA | Standard | Custom |</p>
<p>| Rate limits | Standard | Higher/custom |</p>
<p>| Reporting | Basic | Advanced |</p>
<p>| Multi-tenant | — | Supported |</p>
<p>| Custom accreditation | — | Optional |</p>
<p>| Minimum commitment | None | Typically annual |</p>
<hr>
<h2 id="system-architecture">5. System Architecture</h2>
<h3 id="high-level-architecture">5.1 High-Level Architecture</h3>
<pre class=" language-mermaid"><svg id="mermaid-svg-C9NAi6IxEkl9jf7m" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="653.9733276367188" style="max-width: 1092.0234375px;" viewBox="0 0 1092.0234375 653.9733276367188"><style>#mermaid-svg-C9NAi6IxEkl9jf7m{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-C9NAi6IxEkl9jf7m .error-icon{fill:#552222;}#mermaid-svg-C9NAi6IxEkl9jf7m .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-C9NAi6IxEkl9jf7m .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-C9NAi6IxEkl9jf7m .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-C9NAi6IxEkl9jf7m .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-C9NAi6IxEkl9jf7m .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-C9NAi6IxEkl9jf7m .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-C9NAi6IxEkl9jf7m .marker{fill:#666;stroke:#666;}#mermaid-svg-C9NAi6IxEkl9jf7m .marker.cross{stroke:#666;}#mermaid-svg-C9NAi6IxEkl9jf7m svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-C9NAi6IxEkl9jf7m .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-svg-C9NAi6IxEkl9jf7m .cluster-label text{fill:#333;}#mermaid-svg-C9NAi6IxEkl9jf7m .cluster-label span{color:#333;}#mermaid-svg-C9NAi6IxEkl9jf7m .label text,#mermaid-svg-C9NAi6IxEkl9jf7m span{fill:#000000;color:#000000;}#mermaid-svg-C9NAi6IxEkl9jf7m .node rect,#mermaid-svg-C9NAi6IxEkl9jf7m .node circle,#mermaid-svg-C9NAi6IxEkl9jf7m .node ellipse,#mermaid-svg-C9NAi6IxEkl9jf7m .node polygon,#mermaid-svg-C9NAi6IxEkl9jf7m .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-svg-C9NAi6IxEkl9jf7m .node .label{text-align:center;}#mermaid-svg-C9NAi6IxEkl9jf7m .node.clickable{cursor:pointer;}#mermaid-svg-C9NAi6IxEkl9jf7m .arrowheadPath{fill:#333333;}#mermaid-svg-C9NAi6IxEkl9jf7m .edgePath .path{stroke:#666;stroke-width:1.5px;}#mermaid-svg-C9NAi6IxEkl9jf7m .flowchart-link{stroke:#666;fill:none;}#mermaid-svg-C9NAi6IxEkl9jf7m .edgeLabel{background-color:white;text-align:center;}#mermaid-svg-C9NAi6IxEkl9jf7m .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-svg-C9NAi6IxEkl9jf7m .cluster rect{fill:hsl(210,66.6666666667%,95%);stroke:#26a;stroke-width:1px;}#mermaid-svg-C9NAi6IxEkl9jf7m .cluster text{fill:#333;}#mermaid-svg-C9NAi6IxEkl9jf7m .cluster span{color:#333;}#mermaid-svg-C9NAi6IxEkl9jf7m div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160,0%,93.3333333333%);border:1px solid #26a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-C9NAi6IxEkl9jf7m:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-C9NAi6IxEkl9jf7m flowchart-v2{fill:apa;}</style><g transform="translate(0, 0)"><marker id="flowchart-pointEnd" class="marker flowchart" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-pointStart" class="marker flowchart" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-circleEnd" class="marker flowchart" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-circleStart" class="marker flowchart" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-crossEnd" class="marker cross flowchart" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-crossStart" class="marker cross flowchart" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"><g class="cluster default" id="Admin"><rect style="" rx="0" ry="0" x="185.51171875" y="149.71875" width="173.53125" height="91.71875"></rect><g class="cluster-label" transform="translate(249.80859375, 154.71875)"><foreignObject width="44.9375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Admin</span></div></foreignObject></g></g><g class="cluster default" id="External"><rect style="" rx="0" ry="0" x="425.2578125" y="524.875" width="658.765625" height="121.09830474853516"></rect><g class="cluster-label" transform="translate(693.2734375, 529.875)"><foreignObject width="122.734375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">External Services</span></div></foreignObject></g></g><g class="cluster default" id="Data"><rect style="" rx="0" ry="0" x="134.0078125" y="524.875" width="271.25" height="121.09830474853516"></rect><g class="cluster-label" transform="translate(253.1484375, 529.875)"><foreignObject width="32.96875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Data</span></div></foreignObject></g></g><g class="cluster default" id="Backend"><rect style="" rx="0" ry="0" x="8" y="291.4375" width="1058.4609375" height="183.4375"></rect><g class="cluster-label" transform="translate(475.81640625, 296.4375)"><foreignObject width="122.828125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Backend Services</span></div></foreignObject></g></g><g class="cluster default" id="Frontend"><rect style="" rx="0" ry="0" x="379.04296875" y="149.71875" width="462.9765625" height="91.71875"></rect><g class="cluster-label" transform="translate(578.1953125, 154.71875)"><foreignObject width="64.671875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Frontend</span></div></foreignObject></g></g><g class="cluster default" id="Users"><rect style="" rx="0" ry="0" x="384.41796875" y="8" width="519.203125" height="91.71875"></rect><g class="cluster-label" transform="translate(624.87890625, 13)"><foreignObject width="38.28125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Users</span></div></foreignObject></g></g></g><g class="edgePaths"><path d="M479.33984375,74.71875L479.33984375,78.88541666666667C479.33984375,83.05208333333333,479.33984375,91.38541666666667,479.33984375,99.71875C479.33984375,108.05208333333333,479.33984375,116.38541666666667,479.33984375,124.71875C479.33984375,133.05208333333334,479.33984375,141.38541666666666,483.67402887208976,149.71875C488.00821399417947,158.05208333333334,496.6765842383589,166.38541666666666,501.01076936044865,170.55208333333334L505.34495448253836,174.71875" id="L-WEB-WEB_APP" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-WEB LE-WEB_APP" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M657.33984375,74.71875L657.33984375,78.88541666666667C657.33984375,83.05208333333333,657.33984375,91.38541666666667,657.33984375,99.71875C657.33984375,108.05208333333333,657.33984375,116.38541666666667,657.33984375,124.71875C657.33984375,133.05208333333334,657.33984375,141.38541666666666,660.9393610697047,149.71875C664.5388783894094,158.05208333333334,671.7379130288189,166.38541666666666,675.3374303485235,170.55208333333334L678.9369476682283,174.71875" id="L-MOB-MOB_APP" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-MOB LE-MOB_APP" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M822.01953125,74.71875L822.01953125,78.88541666666667C822.01953125,83.05208333333333,822.01953125,91.38541666666667,822.01953125,99.71875C822.01953125,108.05208333333333,822.01953125,116.38541666666667,822.01953125,124.71875C822.01953125,133.05208333333334,822.01953125,141.38541666666666,783.7395833333334,151.5033849269672C745.4596354166666,161.62135318726772,668.8997395833334,173.5239563745354,630.6197916666666,179.47525796816925L592.33984375,185.42655956180312" id="L-AGT-WEB_APP" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-AGT LE-WEB_APP" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M527.04296875,216.4375L527.04296875,220.60416666666666C527.04296875,224.77083333333334,527.04296875,233.10416666666666,527.04296875,241.4375C527.04296875,249.77083333333334,527.04296875,258.1041666666667,527.04296875,266.4375C527.04296875,274.7708333333333,527.04296875,283.1041666666667,526.8268273530665,291.4375C526.6106859561329,299.7708333333333,526.1784031622658,308.1041666666667,525.9622617653323,312.2708333333333L525.7461203683987,316.4375" id="L-WEB_APP-API" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-WEB_APP LE-API" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M696.95703125,216.4375L696.95703125,220.60416666666666C696.95703125,224.77083333333334,696.95703125,233.10416666666666,696.95703125,241.4375C696.95703125,249.77083333333334,696.95703125,258.1041666666667,696.95703125,266.4375C696.95703125,274.7708333333333,696.95703125,283.1041666666667,680.6595052083334,291.6087605496293C664.3619791666666,300.11335443259196,631.7669270833334,308.7892088651839,615.4694010416666,313.12713608147993L599.171875,317.4650632977759" id="L-MOB_APP-API" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-MOB_APP LE-API" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M272.27734375,216.4375L272.27734375,220.60416666666666C272.27734375,224.77083333333334,272.27734375,233.10416666666666,272.27734375,241.4375C272.27734375,249.77083333333334,272.27734375,258.1041666666667,272.27734375,266.4375C272.27734375,274.7708333333333,272.27734375,283.1041666666667,301.923828125,292.65768273300984C331.5703125,302.21119879935304,390.86328125,312.9848975987061,420.509765625,318.3717469983826L450.15625,323.7585963980591" id="L-ADMIN-API" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-ADMIN LE-API" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M450.15625,345.2565608677453L391.0286458333333,351.57317572312104C331.9010416666667,357.88979057849684,213.64583333333334,370.52302028924845,154.51822916666666,381.0063018112908C95.390625,391.4895833333333,95.390625,399.8229166666667,95.390625,403.9895833333333L95.390625,408.15625" id="L-API-AUTH" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-API LE-AUTH" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M450.15625,350.27340180319845L418.6888020833333,355.7538765026654C387.2213541666667,361.2343512021323,324.2864583333333,372.1953006010661,292.8190104166667,381.8424419671997C261.3515625,391.4895833333333,261.3515625,399.8229166666667,261.3515625,403.9895833333333L261.3515625,408.15625" id="L-API-BOOK" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-API LE-BOOK" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M585.2131068994889,358.15625L597.3077974162408,362.3229166666667C609.4024879329926,366.4895833333333,633.5918689664963,374.8229166666667,645.6865594832482,383.15625C657.78125,391.4895833333333,657.78125,399.8229166666667,657.78125,403.9895833333333L657.78125,408.15625" id="L-API-PAY" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-API LE-PAY" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M599.171875,345.8839433625387L653.072265625,352.09599446878224C706.97265625,358.3080455750258,814.7734375,370.73214778751293,868.673828125,381.1108655604232C922.57421875,391.4895833333333,922.57421875,399.8229166666667,922.57421875,403.9895833333333L922.57421875,408.15625" id="L-API-NOTIF" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-API LE-NOTIF" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M229.6396268100511,449.875L223.3051577583759,454.0416666666667C216.97068870670077,458.2083333333333,204.30175060335037,466.5416666666667,197.9672815516752,474.875C191.6328125,483.2083333333333,191.6328125,491.5416666666667,191.6328125,499.875C191.6328125,508.2083333333333,191.6328125,516.5416666666666,193.697250978467,525.0395743115677C195.76168945693402,533.5374819564685,199.89056641386802,542.199963912937,201.95500489233504,546.5312048911713L204.01944337080204,550.8624458694055" id="L-BOOK-DB" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-BOOK LE-DB" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M261.3515625,449.875L261.3515625,454.0416666666667C261.3515625,458.2083333333333,261.3515625,466.5416666666667,261.3515625,474.875C261.3515625,483.2083333333333,261.3515625,491.5416666666667,261.3515625,499.875C261.3515625,508.2083333333333,261.3515625,516.5416666666666,269.7734375,527.105039160407C278.1953125,537.6684116541475,295.0390625,550.461823308295,303.4609375,556.8585291353687L311.8828125,563.2552349624425" id="L-BOOK-CACHE" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-BOOK LE-CACHE" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M591.2421875,442.69465898445026L565.1529947916666,448.0580491537085C539.0638020833334,453.4214393229668,486.8854166666667,464.1482196614834,460.7962239583333,473.6782764974084C434.70703125,483.2083333333333,434.70703125,491.5416666666667,412.830078125,499.875C390.953125,508.2083333333333,347.19921875,516.5416666666666,318.3951822916667,527.4672419871824C289.5911458333333,538.3928173076982,275.7369791666667,551.9106346153964,268.8098958333333,558.6695432692454L261.8828125,565.4284519230945" id="L-PAY-DB" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-PAY LE-DB" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M302.73805499361157,449.875L311.005019786343,454.0416666666667C319.2719845790744,458.2083333333333,335.80591416453717,466.5416666666667,344.0728789572686,474.875C352.33984375,483.2083333333333,352.33984375,491.5416666666667,377.4576822916667,499.875C402.5755208333333,508.2083333333333,452.8111979166667,516.5416666666666,477.9290364583333,527.3232962290446C503.046875,538.1049257914225,503.046875,551.3348515828451,503.046875,557.9498144785563L503.046875,564.5647773742676" id="L-BOOK-DUFFEL" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-BOOK LE-DUFFEL" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M662.3298019591141,449.875L663.2383766325951,454.0416666666667C664.1469513060761,458.2083333333333,665.964100653038,466.5416666666667,666.872675326519,474.875C667.78125,483.2083333333333,667.78125,491.5416666666667,667.78125,499.875C667.78125,508.2083333333333,667.78125,516.5416666666666,667.78125,527.3232962290446C667.78125,538.1049257914225,667.78125,551.3348515828451,667.78125,557.9498144785563L667.78125,564.5647773742676" id="L-PAY-PGW" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-PAY LE-PGW" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M887.4028960817717,449.875L880.3774134014765,454.0416666666667C873.3519307211812,458.2083333333333,859.3009653605906,466.5416666666667,852.2754826802952,474.875C845.25,483.2083333333333,845.25,491.5416666666667,845.25,499.875C845.25,508.2083333333333,845.25,516.5416666666666,845.25,527.3232962290446C845.25,538.1049257914225,845.25,551.3348515828451,845.25,557.9498144785563L845.25,564.5647773742676" id="L-NOTIF-EMAIL" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-NOTIF LE-EMAIL" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M957.7455414182283,449.875L964.7710240985235,454.0416666666667C971.7965067788188,458.2083333333333,985.8474721394094,466.5416666666667,992.8729548197048,474.875C999.8984375,483.2083333333333,999.8984375,491.5416666666667,999.8984375,499.875C999.8984375,508.2083333333333,999.8984375,516.5416666666666,999.8984375,527.3232962290446C999.8984375,538.1049257914225,999.8984375,551.3348515828451,999.8984375,557.9498144785563L999.8984375,564.5647773742676" id="L-NOTIF-SMS" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-NOTIF LE-SMS" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default default" id="flowchart-ADMIN-1161" transform="translate(272.27734375, 195.578125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-51.765625" y="-20.859375" width="103.53125" height="41.71875"></rect><g class="label" style="" transform="translate(-44.265625, -13.359375)"><foreignObject width="88.53125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Admin Panel</span></div></foreignObject></g></g><g class="node default default" id="flowchart-DUFFEL-1157" transform="translate(503.046875, 585.4241523742676)"><rect class="basic label-container" style="" rx="0" ry="0" x="-42.7890625" y="-20.859375" width="85.578125" height="41.71875"></rect><g class="label" style="" transform="translate(-35.2890625, -13.359375)"><foreignObject width="70.578125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Duffel API</span></div></foreignObject></g></g><g class="node default default" id="flowchart-PGW-1158" transform="translate(667.78125, 585.4241523742676)"><rect class="basic label-container" style="" rx="0" ry="0" x="-71.9453125" y="-20.859375" width="143.890625" height="41.71875"></rect><g class="label" style="" transform="translate(-64.4453125, -13.359375)"><foreignObject width="128.890625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Payment Gateway</span></div></foreignObject></g></g><g class="node default default" id="flowchart-EMAIL-1159" transform="translate(845.25, 585.4241523742676)"><rect class="basic label-container" style="" rx="0" ry="0" x="-55.5234375" y="-20.859375" width="111.046875" height="41.71875"></rect><g class="label" style="" transform="translate(-48.0234375, -13.359375)"><foreignObject width="96.046875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Email Service</span></div></foreignObject></g></g><g class="node default default" id="flowchart-SMS-1160" transform="translate(999.8984375, 585.4241523742676)"><rect class="basic label-container" style="" rx="0" ry="0" x="-49.125" y="-20.859375" width="98.25" height="41.71875"></rect><g class="label" style="" transform="translate(-41.625, -13.359375)"><foreignObject width="83.25" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">SMS Service</span></div></foreignObject></g></g><g class="node default default" id="flowchart-DB-1155" label-offset-y="9.793187347931873" transform="translate(221.6328125, 585.4241523742676)"><path style="" d="M 0,9.793187347931873 a 40.25,9.793187347931873 0,0,0 80.5 0 a 40.25,9.793187347931873 0,0,0 -80.5 0 l 0,51.51193734793188 a 40.25,9.793187347931873 0,0,0 80.5 0 l 0,-51.51193734793188" transform="translate(-40.25,-35.549156021897815)"></path><g class="label" style="" transform="translate(-32.75, -13.359375)"><foreignObject width="65.5" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Database</span></div></foreignObject></g></g><g class="node default default" id="flowchart-CACHE-1156" label-offset-y="7.958418541240627" transform="translate(341.0703125, 585.4241523742676)"><path style="" d="M 0,7.958418541240627 a 29.1875,7.958418541240627 0,0,0 58.375 0 a 29.1875,7.958418541240627 0,0,0 -58.375 0 l 0,49.677168541240626 a 29.1875,7.958418541240627 0,0,0 58.375 0 l 0,-49.677168541240626" transform="translate(-29.1875,-32.79700281186094)"></path><g class="label" style="" transform="translate(-21.6875, -13.359375)"><foreignObject width="43.375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Cache</span></div></foreignObject></g></g><g class="node default default" id="flowchart-API-1150" transform="translate(524.6640625, 337.296875)"><rect class="basic label-container" style="" rx="0" ry="0" x="-74.5078125" y="-20.859375" width="149.015625" height="41.71875"></rect><g class="label" style="" transform="translate(-67.0078125, -13.359375)"><foreignObject width="134.015625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">API Gateway / BFF</span></div></foreignObject></g></g><g class="node default default" id="flowchart-AUTH-1151" transform="translate(95.390625, 429.015625)"><rect class="basic label-container" style="" rx="0" ry="0" x="-52.390625" y="-20.859375" width="104.78125" height="41.71875"></rect><g class="label" style="" transform="translate(-44.890625, -13.359375)"><foreignObject width="89.78125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Auth Service</span></div></foreignObject></g></g><g class="node default default" id="flowchart-BOOK-1152" transform="translate(261.3515625, 429.015625)"><rect class="basic label-container" style="" rx="0" ry="0" x="-63.5703125" y="-20.859375" width="127.140625" height="41.71875"></rect><g class="label" style="" transform="translate(-56.0703125, -13.359375)"><foreignObject width="112.140625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Booking Service</span></div></foreignObject></g></g><g class="node default default" id="flowchart-PAY-1153" transform="translate(657.78125, 429.015625)"><rect class="basic label-container" style="" rx="0" ry="0" x="-66.5390625" y="-20.859375" width="133.078125" height="41.71875"></rect><g class="label" style="" transform="translate(-59.0390625, -13.359375)"><foreignObject width="118.078125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Payment Service</span></div></foreignObject></g></g><g class="node default default" id="flowchart-NOTIF-1154" transform="translate(922.57421875, 429.015625)"><rect class="basic label-container" style="" rx="0" ry="0" x="-78.125" y="-20.859375" width="156.25" height="41.71875"></rect><g class="label" style="" transform="translate(-70.625, -13.359375)"><foreignObject width="141.25" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Notification Service</span></div></foreignObject></g></g><g class="node default default" id="flowchart-WEB_APP-1148" transform="translate(527.04296875, 195.578125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-65.296875" y="-20.859375" width="130.59375" height="41.71875"></rect><g class="label" style="" transform="translate(-57.796875, -13.359375)"><foreignObject width="115.59375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Web Application</span></div></foreignObject></g></g><g class="node default default" id="flowchart-MOB_APP-1149" transform="translate(696.95703125, 195.578125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-46.53125" y="-20.859375" width="93.0625" height="41.71875"></rect><g class="label" style="" transform="translate(-39.03125, -13.359375)"><foreignObject width="78.0625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Mobile App</span></div></foreignObject></g></g><g class="node default default" id="flowchart-WEB-1145" transform="translate(479.33984375, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-59.921875" y="-20.859375" width="119.84375" height="41.71875"></rect><g class="label" style="" transform="translate(-52.421875, -13.359375)"><foreignObject width="104.84375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Web App Users</span></div></foreignObject></g></g><g class="node default default" id="flowchart-MOB-1146" transform="translate(657.33984375, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-68.078125" y="-20.859375" width="136.15625" height="41.71875"></rect><g class="label" style="" transform="translate(-60.578125, -13.359375)"><foreignObject width="121.15625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Mobile App Users</span></div></foreignObject></g></g><g class="node default default" id="flowchart-AGT-1147" transform="translate(822.01953125, 53.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-46.6015625" y="-20.859375" width="93.203125" height="41.71875"></rect><g class="label" style="" transform="translate(-39.1015625, -13.359375)"><foreignObject width="78.203125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">B2B Agents</span></div></foreignObject></g></g></g></g></g></svg></pre>
<h3 id="component-overview">5.2 Component Overview</h3>
<p>| Component | Responsibility |</p>
<p>|-----------|----------------|</p>
<p>| <strong>Web App</strong> | Consumer-facing search, booking, account management |</p>
<p>| <strong>Mobile App</strong> | Native/Flutter/React Native; same flows as web |</p>
<p>| <strong>API Gateway</strong> | Rate limiting, routing, auth |</p>
<p>| <strong>Auth Service</strong> | User/agent auth, JWT, roles |</p>
<p>| <strong>Booking Service</strong> | Orchestrates Duffel calls; stores bookings |</p>
<p>| <strong>Payment Service</strong> | Payment intents, webhooks, refunds |</p>
<p>| <strong>Notification Service</strong> | Email, SMS, push |</p>
<p>| <strong>Database</strong> | Users, bookings, payments, logs |</p>
<p>| <strong>Cache</strong> | Offer caching (short TTL), session data |</p>
<p>| <strong>Admin Panel</strong> | Bookings, users, reports, support tools |</p>
<h3 id="data-flow-flight-search">5.3 Data Flow (Flight Search)</h3>
<pre class=" language-mermaid"><svg id="mermaid-svg-7VmLQhZBKEuPzfTj" width="100%" xmlns="http://www.w3.org/2000/svg" height="837" style="max-width: 1174px;" viewBox="-50 -10 1174 837"><style>#mermaid-svg-7VmLQhZBKEuPzfTj{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-7VmLQhZBKEuPzfTj .error-icon{fill:#552222;}#mermaid-svg-7VmLQhZBKEuPzfTj .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-7VmLQhZBKEuPzfTj .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-7VmLQhZBKEuPzfTj .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-7VmLQhZBKEuPzfTj .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-7VmLQhZBKEuPzfTj .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-7VmLQhZBKEuPzfTj .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-7VmLQhZBKEuPzfTj .marker{fill:#666;stroke:#666;}#mermaid-svg-7VmLQhZBKEuPzfTj .marker.cross{stroke:#666;}#mermaid-svg-7VmLQhZBKEuPzfTj svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-7VmLQhZBKEuPzfTj .actor{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-7VmLQhZBKEuPzfTj text.actor > tspan{fill:#333;stroke:none;}#mermaid-svg-7VmLQhZBKEuPzfTj .actor-line{stroke:#666;}#mermaid-svg-7VmLQhZBKEuPzfTj .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-svg-7VmLQhZBKEuPzfTj .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-svg-7VmLQhZBKEuPzfTj #arrowhead path{fill:#333;stroke:#333;}#mermaid-svg-7VmLQhZBKEuPzfTj .sequenceNumber{fill:white;}#mermaid-svg-7VmLQhZBKEuPzfTj #sequencenumber{fill:#333;}#mermaid-svg-7VmLQhZBKEuPzfTj #crosshead path{fill:#333;stroke:#333;}#mermaid-svg-7VmLQhZBKEuPzfTj .messageText{fill:#333;stroke:#333;}#mermaid-svg-7VmLQhZBKEuPzfTj .labelBox{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-7VmLQhZBKEuPzfTj .labelText,#mermaid-svg-7VmLQhZBKEuPzfTj .labelText > tspan{fill:#333;stroke:none;}#mermaid-svg-7VmLQhZBKEuPzfTj .loopText,#mermaid-svg-7VmLQhZBKEuPzfTj .loopText > tspan{fill:#333;stroke:none;}#mermaid-svg-7VmLQhZBKEuPzfTj .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(0,0%,83%);fill:hsl(0,0%,83%);}#mermaid-svg-7VmLQhZBKEuPzfTj .note{stroke:hsl(60,100%,23.3333333333%);fill:#ffa;}#mermaid-svg-7VmLQhZBKEuPzfTj .noteText,#mermaid-svg-7VmLQhZBKEuPzfTj .noteText > tspan{fill:#333;stroke:none;}#mermaid-svg-7VmLQhZBKEuPzfTj .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-svg-7VmLQhZBKEuPzfTj .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-svg-7VmLQhZBKEuPzfTj .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-svg-7VmLQhZBKEuPzfTj:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-7VmLQhZBKEuPzfTj sequence{fill:apa;}</style><g></g><g><line id="actor63" x1="75" y1="5" x2="75" y2="826" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">User</tspan></text></g><g><line id="actor64" x1="341" y1="5" x2="341" y2="826" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="266" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="341" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="341" dy="0">Frontend</tspan></text></g><g><line id="actor65" x1="541" y1="5" x2="541" y2="826" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="466" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="541" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="541" dy="0">Backend API</tspan></text></g><g><line id="actor66" x1="799" y1="5" x2="799" y2="826" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="724" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="799" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="799" dy="0">Cache</tspan></text></g><g><line id="actor67" x1="999" y1="5" x2="999" y2="826" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="924" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="999" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="999" dy="0">Duffel API</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="208" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Search (origin, dest, dates)</text><line x1="75" y1="113" x2="341" y2="113" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="441" y="128" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">POST /search</text><line x1="341" y1="161" x2="541" y2="161" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="670" y="176" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Check cached offers</text><line x1="541" y1="209" x2="799" y2="209" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="670" y="269" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Cached offers</text><line x1="799" y1="302" x2="541" y2="302" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="441" y="317" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Offers</text><line x1="541" y1="350" x2="341" y2="350" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="770" y="410" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">POST /air/offer_requests</text><line x1="541" y1="443" x2="999" y2="443" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="770" y="458" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Offer request ID</text><line x1="999" y1="491" x2="541" y2="491" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="770" y="506" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">GET /air/offers</text><line x1="541" y1="539" x2="999" y2="539" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="770" y="554" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Offers</text><line x1="999" y1="587" x2="541" y2="587" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="670" y="602" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Store offers (TTL ~25 min)</text><line x1="541" y1="635" x2="799" y2="635" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="441" y="650" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Offers</text><line x1="541" y1="683" x2="341" y2="683" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><g><line x1="331" y1="219" x2="1009" y2="219" class="loopLine"></line><line x1="1009" y1="219" x2="1009" y2="693" class="loopLine"></line><line x1="331" y1="693" x2="1009" y2="693" class="loopLine"></line><line x1="331" y1="219" x2="331" y2="693" class="loopLine"></line><line x1="331" y1="365" x2="1009" y2="365" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="331,219 381,219 381,232 372.6,239 331,239" class="labelBox"></polygon><text x="356" y="232" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">alt</text><text x="695" y="237" text-anchor="middle" class="loopText" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"><tspan x="695">[Cache hit (valid TTL)]</tspan></text><text x="670" y="383" text-anchor="middle" class="loopText" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">[Cache miss]</text></g><text x="208" y="708" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Display results</text><line x1="341" y1="741" x2="75" y2="741" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><g><rect x="0" y="761" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="793.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">User</tspan></text></g><g><rect x="266" y="761" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="341" y="793.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="341" dy="0">Frontend</tspan></text></g><g><rect x="466" y="761" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="541" y="793.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="541" dy="0">Backend API</tspan></text></g><g><rect x="724" y="761" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="799" y="793.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="799" dy="0">Cache</tspan></text></g><g><rect x="924" y="761" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="999" y="793.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="999" dy="0">Duffel API</tspan></text></g></svg></pre>
<hr>
<h2 id="complete-booking-flow-end-to-end">6. Complete Booking Flow (End-to-End)</h2>
<h3 id="booking-sequence-diagram">6.1 Booking Sequence Diagram</h3>
<pre class=" language-mermaid"><svg id="mermaid-svg-IWZaJ9KeqzEJUNlO" width="100%" xmlns="http://www.w3.org/2000/svg" height="1421" style="max-width: 1360px;" viewBox="-50 -10 1360 1421"><style>#mermaid-svg-IWZaJ9KeqzEJUNlO{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-IWZaJ9KeqzEJUNlO .error-icon{fill:#552222;}#mermaid-svg-IWZaJ9KeqzEJUNlO .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-IWZaJ9KeqzEJUNlO .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-IWZaJ9KeqzEJUNlO .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-IWZaJ9KeqzEJUNlO .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-IWZaJ9KeqzEJUNlO .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-IWZaJ9KeqzEJUNlO .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-IWZaJ9KeqzEJUNlO .marker{fill:#666;stroke:#666;}#mermaid-svg-IWZaJ9KeqzEJUNlO .marker.cross{stroke:#666;}#mermaid-svg-IWZaJ9KeqzEJUNlO svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-IWZaJ9KeqzEJUNlO .actor{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-IWZaJ9KeqzEJUNlO text.actor > tspan{fill:#333;stroke:none;}#mermaid-svg-IWZaJ9KeqzEJUNlO .actor-line{stroke:#666;}#mermaid-svg-IWZaJ9KeqzEJUNlO .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-svg-IWZaJ9KeqzEJUNlO .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-svg-IWZaJ9KeqzEJUNlO #arrowhead path{fill:#333;stroke:#333;}#mermaid-svg-IWZaJ9KeqzEJUNlO .sequenceNumber{fill:white;}#mermaid-svg-IWZaJ9KeqzEJUNlO #sequencenumber{fill:#333;}#mermaid-svg-IWZaJ9KeqzEJUNlO #crosshead path{fill:#333;stroke:#333;}#mermaid-svg-IWZaJ9KeqzEJUNlO .messageText{fill:#333;stroke:#333;}#mermaid-svg-IWZaJ9KeqzEJUNlO .labelBox{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-IWZaJ9KeqzEJUNlO .labelText,#mermaid-svg-IWZaJ9KeqzEJUNlO .labelText > tspan{fill:#333;stroke:none;}#mermaid-svg-IWZaJ9KeqzEJUNlO .loopText,#mermaid-svg-IWZaJ9KeqzEJUNlO .loopText > tspan{fill:#333;stroke:none;}#mermaid-svg-IWZaJ9KeqzEJUNlO .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(0,0%,83%);fill:hsl(0,0%,83%);}#mermaid-svg-IWZaJ9KeqzEJUNlO .note{stroke:hsl(60,100%,23.3333333333%);fill:#ffa;}#mermaid-svg-IWZaJ9KeqzEJUNlO .noteText,#mermaid-svg-IWZaJ9KeqzEJUNlO .noteText > tspan{fill:#333;stroke:none;}#mermaid-svg-IWZaJ9KeqzEJUNlO .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-svg-IWZaJ9KeqzEJUNlO .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-svg-IWZaJ9KeqzEJUNlO .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-svg-IWZaJ9KeqzEJUNlO:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-IWZaJ9KeqzEJUNlO sequence{fill:apa;}</style><g></g><g><line id="actor68" x1="75" y1="5" x2="75" y2="1410" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">User</tspan></text></g><g><line id="actor69" x1="361" y1="5" x2="361" y2="1410" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="286" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="361" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="361" dy="0">Frontend</tspan></text></g><g><line id="actor70" x1="704" y1="5" x2="704" y2="1410" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="629" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="704" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="704" dy="0">Backend</tspan></text></g><g><line id="actor71" x1="985" y1="5" x2="985" y2="1410" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="910" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="985" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="985" dy="0">Duffel API</tspan></text></g><g><line id="actor72" x1="1185" y1="5" x2="1185" y2="1410" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1110" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1185" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1185" dy="0">Payment Gateway</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="218" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">1. Search flights</text><line x1="75" y1="113" x2="361" y2="113" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="533" y="128" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">POST /search</text><line x1="361" y1="161" x2="704" y2="161" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="845" y="176" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Create offer request</text><line x1="704" y1="209" x2="985" y2="209" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="845" y="224" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Offers</text><line x1="985" y1="257" x2="704" y2="257" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="533" y="272" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Offers</text><line x1="704" y1="305" x2="361" y2="305" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="218" y="320" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">2. Display &amp; select flight</text><line x1="361" y1="353" x2="75" y2="353" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="218" y="368" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">3. Select offer</text><line x1="75" y1="401" x2="361" y2="401" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="533" y="416" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">GET /offers/{id} (validate)</text><line x1="361" y1="449" x2="704" y2="449" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="845" y="464" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">GET offer (confirm still valid)</text><line x1="704" y1="497" x2="985" y2="497" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="533" y="512" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Offer details</text><line x1="704" y1="545" x2="361" y2="545" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="218" y="560" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">4. Enter passenger details</text><line x1="75" y1="593" x2="361" y2="593" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="533" y="608" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">POST /bookings (offer_id, passengers)</text><line x1="361" y1="641" x2="704" y2="641" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="704" y="656" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Validate passengers</text><path d="M 704,689 C 764,679 764,719 704,709" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="945" y="734" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Create payment intent</text><line x1="704" y1="767" x2="1185" y2="767" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="945" y="782" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Client secret</text><line x1="1185" y1="815" x2="704" y2="815" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="533" y="830" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Payment intent + order payload</text><line x1="704" y1="863" x2="361" y2="863" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="218" y="878" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">5. Complete payment</text><line x1="75" y1="911" x2="361" y2="911" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="773" y="926" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Confirm payment</text><line x1="361" y1="959" x2="1185" y2="959" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="773" y="974" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Payment succeeded</text><line x1="1185" y1="1007" x2="361" y2="1007" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="533" y="1022" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">POST /orders (payment ref)</text><line x1="361" y1="1055" x2="704" y2="1055" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="845" y="1070" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">POST /air/orders</text><line x1="704" y1="1103" x2="985" y2="1103" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="845" y="1118" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Order (PNR, status)</text><line x1="985" y1="1151" x2="704" y2="1151" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="704" y="1166" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Store booking, send confirmation</text><path d="M 704,1199 C 764,1189 764,1229 704,1219" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="533" y="1244" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Order confirmation</text><line x1="704" y1="1277" x2="361" y2="1277" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="218" y="1292" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">6. Show confirmation &amp; ticket</text><line x1="361" y1="1325" x2="75" y2="1325" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><g><rect x="0" y="1345" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="1377.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">User</tspan></text></g><g><rect x="286" y="1345" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="361" y="1377.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="361" dy="0">Frontend</tspan></text></g><g><rect x="629" y="1345" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="704" y="1377.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="704" dy="0">Backend</tspan></text></g><g><rect x="910" y="1345" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="985" y="1377.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="985" dy="0">Duffel API</tspan></text></g><g><rect x="1110" y="1345" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1185" y="1377.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1185" dy="0">Payment Gateway</tspan></text></g></svg></pre>
<h3 id="key-api-flow-offers-search">6.2 Key API Flow: Offers (Search)</h3>
<pre class=" language-mermaid"><svg id="mermaid-svg-neGPZcbfsWuGEH8d" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="57.71875" style="max-width: 1112.234375px;" viewBox="0 0 1112.234375 57.71875"><style>#mermaid-svg-neGPZcbfsWuGEH8d{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-neGPZcbfsWuGEH8d .error-icon{fill:#552222;}#mermaid-svg-neGPZcbfsWuGEH8d .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-neGPZcbfsWuGEH8d .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-neGPZcbfsWuGEH8d .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-neGPZcbfsWuGEH8d .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-neGPZcbfsWuGEH8d .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-neGPZcbfsWuGEH8d .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-neGPZcbfsWuGEH8d .marker{fill:#666;stroke:#666;}#mermaid-svg-neGPZcbfsWuGEH8d .marker.cross{stroke:#666;}#mermaid-svg-neGPZcbfsWuGEH8d svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-neGPZcbfsWuGEH8d .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-svg-neGPZcbfsWuGEH8d .cluster-label text{fill:#333;}#mermaid-svg-neGPZcbfsWuGEH8d .cluster-label span{color:#333;}#mermaid-svg-neGPZcbfsWuGEH8d .label text,#mermaid-svg-neGPZcbfsWuGEH8d span{fill:#000000;color:#000000;}#mermaid-svg-neGPZcbfsWuGEH8d .node rect,#mermaid-svg-neGPZcbfsWuGEH8d .node circle,#mermaid-svg-neGPZcbfsWuGEH8d .node ellipse,#mermaid-svg-neGPZcbfsWuGEH8d .node polygon,#mermaid-svg-neGPZcbfsWuGEH8d .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-svg-neGPZcbfsWuGEH8d .node .label{text-align:center;}#mermaid-svg-neGPZcbfsWuGEH8d .node.clickable{cursor:pointer;}#mermaid-svg-neGPZcbfsWuGEH8d .arrowheadPath{fill:#333333;}#mermaid-svg-neGPZcbfsWuGEH8d .edgePath .path{stroke:#666;stroke-width:1.5px;}#mermaid-svg-neGPZcbfsWuGEH8d .flowchart-link{stroke:#666;fill:none;}#mermaid-svg-neGPZcbfsWuGEH8d .edgeLabel{background-color:white;text-align:center;}#mermaid-svg-neGPZcbfsWuGEH8d .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-svg-neGPZcbfsWuGEH8d .cluster rect{fill:hsl(210,66.6666666667%,95%);stroke:#26a;stroke-width:1px;}#mermaid-svg-neGPZcbfsWuGEH8d .cluster text{fill:#333;}#mermaid-svg-neGPZcbfsWuGEH8d .cluster span{color:#333;}#mermaid-svg-neGPZcbfsWuGEH8d div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160,0%,93.3333333333%);border:1px solid #26a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-neGPZcbfsWuGEH8d:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-neGPZcbfsWuGEH8d flowchart-v2{fill:apa;}</style><g transform="translate(0, 0)"><marker id="flowchart-pointEnd" class="marker flowchart" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-pointStart" class="marker flowchart" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-circleEnd" class="marker flowchart" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-circleStart" class="marker flowchart" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-crossEnd" class="marker cross flowchart" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-crossStart" class="marker cross flowchart" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M204.5625,28.859375L208.72916666666666,28.859375C212.89583333333334,28.859375,221.22916666666666,28.859375,229.5625,28.859375C237.89583333333334,28.859375,246.22916666666666,28.859375,250.39583333333334,28.859375L254.5625,28.859375" id="L-A-B" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M387.625,28.859375L391.7916666666667,28.859375C395.9583333333333,28.859375,404.2916666666667,28.859375,412.625,28.859375C420.9583333333333,28.859375,429.2916666666667,28.859375,433.4583333333333,28.859375L437.625,28.859375" id="L-B-C" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M563.640625,28.859375L567.8072916666666,28.859375C571.9739583333334,28.859375,580.3072916666666,28.859375,588.640625,28.859375C596.9739583333334,28.859375,605.3072916666666,28.859375,609.4739583333334,28.859375L613.640625,28.859375" id="L-C-D" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M722.296875,28.859375L726.4635416666666,28.859375C730.6302083333334,28.859375,738.9635416666666,28.859375,747.296875,28.859375C755.6302083333334,28.859375,763.9635416666666,28.859375,768.1302083333334,28.859375L772.296875,28.859375" id="L-D-E" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M916.90625,28.859375L921.0729166666666,28.859375C925.2395833333334,28.859375,933.5729166666666,28.859375,941.90625,28.859375C950.2395833333334,28.859375,958.5729166666666,28.859375,962.7395833333334,28.859375L966.90625,28.859375" id="L-E-F" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default default" id="flowchart-A-1212" transform="translate(106.28125, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-98.28125" y="-20.859375" width="196.5625" height="41.71875"></rect><g class="label" style="" transform="translate(-90.78125, -13.359375)"><foreignObject width="181.5625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">POST /air/offer_requests</span></div></foreignObject></g></g><g class="node default default" id="flowchart-B-1213" transform="translate(321.09375, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-66.53125" y="-20.859375" width="133.0625" height="41.71875"></rect><g class="label" style="" transform="translate(-59.03125, -13.359375)"><foreignObject width="118.0625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Offer Request ID</span></div></foreignObject></g></g><g class="node default default" id="flowchart-C-1215" transform="translate(500.6328125, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-63.0078125" y="-20.859375" width="126.015625" height="41.71875"></rect><g class="label" style="" transform="translate(-55.5078125, -13.359375)"><foreignObject width="111.015625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">GET /air/offers</span></div></foreignObject></g></g><g class="node default default" id="flowchart-D-1217" transform="translate(667.96875, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-54.328125" y="-20.859375" width="108.65625" height="41.71875"></rect><g class="label" style="" transform="translate(-46.828125, -13.359375)"><foreignObject width="93.65625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">List of Offers</span></div></foreignObject></g></g><g class="node default default" id="flowchart-E-1219" transform="translate(844.6015625, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-72.3046875" y="-20.859375" width="144.609375" height="41.71875"></rect><g class="label" style="" transform="translate(-64.8046875, -13.359375)"><foreignObject width="129.609375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">User Selects Offer</span></div></foreignObject></g></g><g class="node default default" id="flowchart-F-1221" transform="translate(1035.5703125, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-68.6640625" y="-20.859375" width="137.328125" height="41.71875"></rect><g class="label" style="" transform="translate(-61.1640625, -13.359375)"><foreignObject width="122.328125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">POST /air/orders</span></div></foreignObject></g></g></g></g></g></svg></pre>
<p><strong>Flow detail:</strong></p>
<ol>
<li>
<p><strong>Create offer request</strong>: <code>POST /air/offer_requests</code> with <code>slices</code> (origin, destination, departure_date), <code>passengers</code> (type, count).</p>
</li>
<li>
<p><strong>Retrieve offers</strong>: <code>GET /air/offers?offer_request_id={id}</code> — paginate with <code>after</code> cursor.</p>
</li>
<li>
<p><strong>Offer validity</strong>: Each offer has <code>expires_at</code>; typically 30 minutes. Re-validate before booking.</p>
</li>
</ol>
<h3 id="key-api-flow-order-creation">6.3 Key API Flow: Order Creation</h3>
<pre class=" language-mermaid"><svg id="mermaid-svg-JjGGgQ49K29umueF" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="149.4375" style="max-width: 1049.78125px;" viewBox="0 0 1049.78125 149.4375"><style>#mermaid-svg-JjGGgQ49K29umueF{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-JjGGgQ49K29umueF .error-icon{fill:#552222;}#mermaid-svg-JjGGgQ49K29umueF .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-JjGGgQ49K29umueF .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-JjGGgQ49K29umueF .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-JjGGgQ49K29umueF .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-JjGGgQ49K29umueF .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-JjGGgQ49K29umueF .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-JjGGgQ49K29umueF .marker{fill:#666;stroke:#666;}#mermaid-svg-JjGGgQ49K29umueF .marker.cross{stroke:#666;}#mermaid-svg-JjGGgQ49K29umueF svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-JjGGgQ49K29umueF .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-svg-JjGGgQ49K29umueF .cluster-label text{fill:#333;}#mermaid-svg-JjGGgQ49K29umueF .cluster-label span{color:#333;}#mermaid-svg-JjGGgQ49K29umueF .label text,#mermaid-svg-JjGGgQ49K29umueF span{fill:#000000;color:#000000;}#mermaid-svg-JjGGgQ49K29umueF .node rect,#mermaid-svg-JjGGgQ49K29umueF .node circle,#mermaid-svg-JjGGgQ49K29umueF .node ellipse,#mermaid-svg-JjGGgQ49K29umueF .node polygon,#mermaid-svg-JjGGgQ49K29umueF .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-svg-JjGGgQ49K29umueF .node .label{text-align:center;}#mermaid-svg-JjGGgQ49K29umueF .node.clickable{cursor:pointer;}#mermaid-svg-JjGGgQ49K29umueF .arrowheadPath{fill:#333333;}#mermaid-svg-JjGGgQ49K29umueF .edgePath .path{stroke:#666;stroke-width:1.5px;}#mermaid-svg-JjGGgQ49K29umueF .flowchart-link{stroke:#666;fill:none;}#mermaid-svg-JjGGgQ49K29umueF .edgeLabel{background-color:white;text-align:center;}#mermaid-svg-JjGGgQ49K29umueF .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-svg-JjGGgQ49K29umueF .cluster rect{fill:hsl(210,66.6666666667%,95%);stroke:#26a;stroke-width:1px;}#mermaid-svg-JjGGgQ49K29umueF .cluster text{fill:#333;}#mermaid-svg-JjGGgQ49K29umueF .cluster span{color:#333;}#mermaid-svg-JjGGgQ49K29umueF div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160,0%,93.3333333333%);border:1px solid #26a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-JjGGgQ49K29umueF:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-JjGGgQ49K29umueF flowchart-v2{fill:apa;}</style><g transform="translate(0, 0)"><marker id="flowchart-pointEnd" class="marker flowchart" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-pointStart" class="marker flowchart" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-circleEnd" class="marker flowchart" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-circleStart" class="marker flowchart" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-crossEnd" class="marker cross flowchart" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-crossStart" class="marker cross flowchart" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M128.59375,74.71875L132.76041666666666,74.71875C136.92708333333334,74.71875,145.26041666666666,74.71875,153.59375,74.71875C161.92708333333334,74.71875,170.26041666666666,74.71875,174.42708333333334,74.71875L178.59375,74.71875" id="L-A-B" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M330.25,74.71875L334.4166666666667,74.71875C338.5833333333333,74.71875,346.9166666666667,74.71875,355.25,74.71875C363.5833333333333,74.71875,371.9166666666667,74.71875,376.0833333333333,74.71875L380.25,74.71875" id="L-B-C" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M509.625,74.71875L513.7916666666666,74.71875C517.9583333333334,74.71875,526.2916666666666,74.71875,534.625,74.71875C542.9583333333334,74.71875,551.2916666666666,74.71875,555.4583333333334,74.71875L559.625,74.71875" id="L-C-D" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M696.953125,74.71875L701.1197916666666,74.71875C705.2864583333334,74.71875,713.6197916666666,74.71875,722.0364583333334,74.80208333333333C730.453125,74.88541666666667,738.953125,75.05208333333333,743.203125,75.13541666666667L747.453125,75.21875" id="L-D-E" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M844.988320355951,56.19144535595105L854.1308919632925,51.63610029662588C863.2734635706341,47.08075523730071,881.558606785317,37.97006511865035,897.0280013093252,33.41472005932518C912.4973958333334,28.859375,925.1510416666666,28.859375,931.4778645833334,28.859375L937.8046875,28.859375" id="L-E-F" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M844.988320355951,94.24605464404894L854.1308919632925,98.63473303670746C863.2734635706341,103.02341142936596,881.558606785317,111.80076821468299,896.7558658926586,116.1894466073415C911.953125,120.578125,924.0625,120.578125,930.1171875,120.578125L936.171875,120.578125" id="L-E-G" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-G" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(899.84375, 28.859375)"><g class="label" transform="translate(-11.328125, -13.359375)"><foreignObject width="22.65625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">Yes</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(899.84375, 120.578125)"><g class="label" transform="translate(-9.3984375, -13.359375)"><foreignObject width="18.796875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">No</span></div></foreignObject></g></g></g><g class="nodes"><g class="node default default" id="flowchart-A-1234" transform="translate(68.296875, 74.71875)"><rect class="basic label-container" style="" rx="0" ry="0" x="-60.296875" y="-20.859375" width="120.59375" height="41.71875"></rect><g class="label" style="" transform="translate(-52.796875, -13.359375)"><foreignObject width="105.59375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Select Offer ID</span></div></foreignObject></g></g><g class="node default default" id="flowchart-B-1235" transform="translate(254.421875, 74.71875)"><rect class="basic label-container" style="" rx="0" ry="0" x="-75.828125" y="-20.859375" width="151.65625" height="41.71875"></rect><g class="label" style="" transform="translate(-68.328125, -13.359375)"><foreignObject width="136.65625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Prepare Passengers</span></div></foreignObject></g></g><g class="node default default" id="flowchart-C-1237" transform="translate(444.9375, 74.71875)"><rect class="basic label-container" style="" rx="0" ry="0" x="-64.6875" y="-20.859375" width="129.375" height="41.71875"></rect><g class="label" style="" transform="translate(-57.1875, -13.359375)"><foreignObject width="114.375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Create Payment</span></div></foreignObject></g></g><g class="node default default" id="flowchart-D-1239" transform="translate(628.2890625, 74.71875)"><rect class="basic label-container" style="" rx="0" ry="0" x="-68.6640625" y="-20.859375" width="137.328125" height="41.71875"></rect><g class="label" style="" transform="translate(-61.1640625, -13.359375)"><foreignObject width="122.328125" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">POST /air/orders</span></div></foreignObject></g></g><g class="node default default" id="flowchart-E-1241" transform="translate(805.234375, 74.71875)"><polygon points="58.28125,0 116.5625,-58.28125 58.28125,-116.5625 0,-58.28125" class="label-container" transform="translate(-58.28125,58.28125)" style=""></polygon><g class="label" style="" transform="translate(-29.921875, -13.359375)"><foreignObject width="59.84375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Success?</span></div></foreignObject></g></g><g class="node default default" id="flowchart-F-1243" transform="translate(988.9765625, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-51.171875" y="-20.859375" width="102.34375" height="41.71875"></rect><g class="label" style="" transform="translate(-43.671875, -13.359375)"><foreignObject width="87.34375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Order + PNR</span></div></foreignObject></g></g><g class="node default default" id="flowchart-G-1245" transform="translate(988.9765625, 120.578125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-52.8046875" y="-20.859375" width="105.609375" height="41.71875"></rect><g class="label" style="" transform="translate(-45.3046875, -13.359375)"><foreignObject width="90.609375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Handle Error</span></div></foreignObject></g></g></g></g></g></svg></pre>
<p><strong>Request payload (simplified):</strong></p>
<ul>
<li>
<p><code>selected_offers</code>: Array of offer IDs</p>
</li>
<li>
<p><code>passengers</code>: <code>[{ type: "adult", given_name, family_name, dob }]</code></p>
</li>
<li>
<p><code>payments</code>: Payment intent ID or balance</p>
</li>
<li>
<p><code>metadata</code>: Optional key-value for your reference</p>
</li>
</ul>
<h3 id="key-api-flow-cancellation">6.4 Key API Flow: Cancellation</h3>
<pre class=" language-mermaid"><svg id="mermaid-svg-X1Umncg8rv4ggPSi" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="57.71875" style="max-width: 1246.578125px;" viewBox="0 0 1246.578125 57.71875"><style>#mermaid-svg-X1Umncg8rv4ggPSi{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-X1Umncg8rv4ggPSi .error-icon{fill:#552222;}#mermaid-svg-X1Umncg8rv4ggPSi .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-X1Umncg8rv4ggPSi .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-X1Umncg8rv4ggPSi .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-X1Umncg8rv4ggPSi .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-X1Umncg8rv4ggPSi .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-X1Umncg8rv4ggPSi .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-X1Umncg8rv4ggPSi .marker{fill:#666;stroke:#666;}#mermaid-svg-X1Umncg8rv4ggPSi .marker.cross{stroke:#666;}#mermaid-svg-X1Umncg8rv4ggPSi svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-X1Umncg8rv4ggPSi .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-svg-X1Umncg8rv4ggPSi .cluster-label text{fill:#333;}#mermaid-svg-X1Umncg8rv4ggPSi .cluster-label span{color:#333;}#mermaid-svg-X1Umncg8rv4ggPSi .label text,#mermaid-svg-X1Umncg8rv4ggPSi span{fill:#000000;color:#000000;}#mermaid-svg-X1Umncg8rv4ggPSi .node rect,#mermaid-svg-X1Umncg8rv4ggPSi .node circle,#mermaid-svg-X1Umncg8rv4ggPSi .node ellipse,#mermaid-svg-X1Umncg8rv4ggPSi .node polygon,#mermaid-svg-X1Umncg8rv4ggPSi .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-svg-X1Umncg8rv4ggPSi .node .label{text-align:center;}#mermaid-svg-X1Umncg8rv4ggPSi .node.clickable{cursor:pointer;}#mermaid-svg-X1Umncg8rv4ggPSi .arrowheadPath{fill:#333333;}#mermaid-svg-X1Umncg8rv4ggPSi .edgePath .path{stroke:#666;stroke-width:1.5px;}#mermaid-svg-X1Umncg8rv4ggPSi .flowchart-link{stroke:#666;fill:none;}#mermaid-svg-X1Umncg8rv4ggPSi .edgeLabel{background-color:white;text-align:center;}#mermaid-svg-X1Umncg8rv4ggPSi .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-svg-X1Umncg8rv4ggPSi .cluster rect{fill:hsl(210,66.6666666667%,95%);stroke:#26a;stroke-width:1px;}#mermaid-svg-X1Umncg8rv4ggPSi .cluster text{fill:#333;}#mermaid-svg-X1Umncg8rv4ggPSi .cluster span{color:#333;}#mermaid-svg-X1Umncg8rv4ggPSi div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160,0%,93.3333333333%);border:1px solid #26a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-X1Umncg8rv4ggPSi:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-X1Umncg8rv4ggPSi flowchart-v2{fill:apa;}</style><g transform="translate(0, 0)"><marker id="flowchart-pointEnd" class="marker flowchart" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-pointStart" class="marker flowchart" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-circleEnd" class="marker flowchart" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-circleStart" class="marker flowchart" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-crossEnd" class="marker cross flowchart" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-crossStart" class="marker cross flowchart" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M241.515625,28.859375L245.68229166666666,28.859375C249.84895833333334,28.859375,258.1822916666667,28.859375,266.515625,28.859375C274.8489583333333,28.859375,283.1822916666667,28.859375,287.3489583333333,28.859375L291.515625,28.859375" id="L-A-B" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M444,28.859375L448.1666666666667,28.859375C452.3333333333333,28.859375,460.6666666666667,28.859375,469,28.859375C477.3333333333333,28.859375,485.6666666666667,28.859375,489.8333333333333,28.859375L494,28.859375" id="L-B-C" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M608.96875,28.859375L613.1354166666666,28.859375C617.3020833333334,28.859375,625.6354166666666,28.859375,633.96875,28.859375C642.3020833333334,28.859375,650.6354166666666,28.859375,654.8020833333334,28.859375L658.96875,28.859375" id="L-C-D" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M855.859375,28.859375L860.0260416666666,28.859375C864.1927083333334,28.859375,872.5260416666666,28.859375,880.859375,28.859375C889.1927083333334,28.859375,897.5260416666666,28.859375,901.6927083333334,28.859375L905.859375,28.859375" id="L-D-E" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M1051.109375,28.859375L1055.2760416666667,28.859375C1059.4427083333333,28.859375,1067.7760416666667,28.859375,1076.109375,28.859375C1084.4427083333333,28.859375,1092.7760416666667,28.859375,1096.9427083333333,28.859375L1101.109375,28.859375" id="L-E-F" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default default" id="flowchart-A-1256" transform="translate(124.7578125, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-116.7578125" y="-20.859375" width="233.515625" height="41.71875"></rect><g class="label" style="" transform="translate(-109.2578125, -13.359375)"><foreignObject width="218.515625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">POST /air/order_cancellations</span></div></foreignObject></g></g><g class="node default default" id="flowchart-B-1257" transform="translate(367.7578125, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-76.2421875" y="-20.859375" width="152.484375" height="41.71875"></rect><g class="label" style="" transform="translate(-68.7421875, -13.359375)"><foreignObject width="137.484375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Cancellation Quote</span></div></foreignObject></g></g><g class="node default default" id="flowchart-C-1259" transform="translate(551.484375, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-57.484375" y="-20.859375" width="114.96875" height="41.71875"></rect><g class="label" style="" transform="translate(-49.984375, -13.359375)"><foreignObject width="99.96875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">User Confirms</span></div></foreignObject></g></g><g class="node default default" id="flowchart-D-1261" transform="translate(757.4140625, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-98.4453125" y="-20.859375" width="196.890625" height="41.71875"></rect><g class="label" style="" transform="translate(-90.9453125, -13.359375)"><foreignObject width="181.890625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">POST .../actions/confirm</span></div></foreignObject></g></g><g class="node default default" id="flowchart-E-1263" transform="translate(978.484375, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-72.625" y="-20.859375" width="145.25" height="41.71875"></rect><g class="label" style="" transform="translate(-65.125, -13.359375)"><foreignObject width="130.25" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Refund to Balance</span></div></foreignObject></g></g><g class="node default default" id="flowchart-F-1265" transform="translate(1169.84375, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-68.734375" y="-20.859375" width="137.46875" height="41.71875"></rect><g class="label" style="" transform="translate(-61.234375, -13.359375)"><foreignObject width="122.46875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Refund Customer</span></div></foreignObject></g></g></g></g></g></svg></pre>
<h3 id="step-by-step-flow-description">6.5 Step-by-Step Flow Description</h3>
<p>| Step | Action | Systems |</p>
<p>|------|--------|---------|</p>
<p>| 1 | User submits search (origin, destination, dates, passengers) | Frontend → Backend → Duffel |</p>
<p>| 2 | User selects flight from offers; backend re-validates offer | Frontend → Backend → Duffel |</p>
<p>| 3 | User enters passenger names, DOB; backend validates | Frontend → Backend |</p>
<p>| 4 | User pays; payment gateway processes | Frontend → Payment Gateway |</p>
<p>| 5 | Backend creates Duffel order with payment reference | Backend → Duffel |</p>
<p>| 6 | Duffel returns order with PNR; backend stores &amp; notifies | Duffel → Backend → User |</p>
<p>| 7 | Ticket issuance (automatic or async); confirmation sent | Duffel / Backend |</p>
<hr>
<h2 id="step-by-step-integration-guide">7. Step-by-Step Integration Guide</h2>
<h3 id="phase-1-—-account-setup">PHASE 1 — Account Setup</h3>
<p>| Step | Action | Details |</p>
<p>|------|--------|---------|</p>
<p>| 1.1 | Create Duffel account | Sign up at <a href="https://duffel.com">duffel.com</a> |</p>
<p>| 1.2 | Obtain API keys | Dashboard → API Keys → Create; note test vs live |</p>
<p>| 1.3 | Sandbox setup | Use <code>duffel_test_</code> token; base URL: <code>https://api.duffel.com</code> |</p>
<p>| 1.4 | Dashboard overview | API keys, webhooks, orders, balance, logs |</p>
<p><strong>Required Headers for All Requests:</strong></p>
<pre><code>
Authorization: Bearer &lt;ACCESS_TOKEN&gt;

Duffel-Version: v2

Accept: application/json

Content-Type: application/json

</code></pre>
<h3 id="phase-2-—-backend-setup">PHASE 2 — Backend Setup</h3>
<p>| Step | Action | Details |</p>
<p>|------|--------|---------|</p>
<p>| 2.1 | Authentication | Store token in secrets manager (e.g., AWS Secrets Manager, Vault) |</p>
<p>| 2.2 | API client | Use official SDK (PHP, Node, Python) or HTTP client with retries |</p>
<p>| 2.3 | Environment config | <code>DUFFEL_API_KEY</code>, <code>DUFFEL_ENV=test|live</code> |</p>
<p>| 2.4 | Secure storage | Never commit keys; use env vars or secrets at runtime |</p>
<p><strong>Example environment variables:</strong></p>
<pre><code>
DUFFEL_API_KEY=duffel_test_xxxxxxxxxxxx

DUFFEL_ENV=test

DUFFEL_API_BASE=https://api.duffel.com

</code></pre>
<h3 id="phase-3-—-flight-search-integration">PHASE 3 — Flight Search Integration</h3>
<p>| Step | Action | Details |</p>
<p>|------|--------|---------|</p>
<p>| 3.1 | Create offer request | <code>POST /air/offer_requests</code> with slices, passengers |</p>
<p>| 3.2 | List offers | <code>GET /air/offers?offer_request_id={id}</code> |</p>
<p>| 3.3 | Filters | <code>max_connections</code>, <code>airline</code>, <code>cabin_class</code> |</p>
<p>| 3.4 | Pagination | Use <code>after</code> cursor for large result sets |</p>
<p>| 3.5 | Caching | Cache by request hash; TTL 25 minutes (offers expire ~30 min) |</p>
<p><strong>Search-to-book ratio:</strong> Stay within 1500:1 to avoid excess search fees (Basic plan).</p>
<h3 id="phase-4-—-booking-integration">PHASE 4 — Booking Integration</h3>
<p>| Step | Action | Details |</p>
<p>|------|--------|---------|</p>
<p>| 4.1 | Create order | <code>POST /air/orders</code> with <code>selected_offers</code>, <code>passengers</code>, <code>payments</code> |</p>
<p>| 4.2 | Passenger data | Full name, DOB (required); match offer passenger count |</p>
<p>| 4.3 | Validation | Names, DOB format; no special chars in names |</p>
<p>| 4.4 | Idempotency | Use <code>Idempotency-Key</code> header for retry safety |</p>
<h3 id="phase-5-—-payment-handling">PHASE 5 — Payment Handling</h3>
<p>| Step | Action | Details |</p>
<p>|------|--------|---------|</p>
<p>| 5.1 | Payment flow | Payment Intent (Duffel) or external gateway (Stripe, etc.) |</p>
<p>| 5.2 | External gateway | Charge customer → pass payment ref to Duffel where supported |</p>
<p>| 5.3 | Currency | Store and display in user currency; handle FX where applicable |</p>
<p>| 5.4 | Webhooks | Listen for <code>payment.succeeded</code> before considering order confirmed |</p>
<h3 id="phase-6-—-ticketing--confirmation">PHASE 6 — Ticketing &amp; Confirmation</h3>
<p>| Step | Action | Details |</p>
<p>|------|--------|---------|</p>
<p>| 6.1 | Order retrieval | <code>GET /air/orders/{id}</code> for PNR, status, conditions |</p>
<p>| 6.2 | PNR handling | Store <code>booking_reference</code>; display on confirmation |</p>
<p>| 6.3 | Email | Trigger confirmation email with PNR, itinerary, policies |</p>
<h3 id="phase-7-—-post-booking-management">PHASE 7 — Post-Booking Management</h3>
<p>| Step | Action | Details |</p>
<p>|------|--------|---------|</p>
<p>| 7.1 | Cancellation | Create cancellation quote → confirm; refund to balance → refund customer |</p>
<p>| 7.2 | Changes | <code>POST /air/order_changes</code> for date/route changes where supported |</p>
<p>| 7.3 | Refunds | Use Refunds API for Payment Intent refunds; else manual from balance |</p>
<p>| 7.4 | Support tools | Admin view of <code>available_actions</code>, conditions, refund quotes |</p>
<h3 id="phase-8-—-admin-panel-features">PHASE 8 — Admin Panel Features</h3>
<p>| Feature | Implementation |</p>
<p>|---------|----------------|</p>
<p>| Booking management | List/filter orders; view PNR, status, passengers |</p>
<p>| Reporting | Aggregate by date, airline, agent; revenue, ancillaries |</p>
<p>| User management | Agents, roles, commissions |</p>
<p>| Refund handling | Initiate cancellations, track refund status |</p>
<hr>
<h2 id="data-models--database-design-suggestions">8. Data Models &amp; Database Design Suggestions</h2>
<h3 id="suggested-schema">8.1 Suggested Schema</h3>
<pre class=" language-mermaid"><svg id="mermaid-svg-yzIyUUEk5ZAKuHzQ" width="100%" xmlns="http://www.w3.org/2000/svg" height="40" style="max-width: 40px;" viewBox="-20 -20 40 40"><style>#mermaid-svg-yzIyUUEk5ZAKuHzQ{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .error-icon{fill:#552222;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .marker{fill:#666;stroke:#666;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .marker.cross{stroke:#666;}#mermaid-svg-yzIyUUEk5ZAKuHzQ svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .entityBox{fill:#eee;stroke:#999;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .attributeBoxOdd{fill:#ffffff;stroke:#999;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .attributeBoxEven{fill:#f2f2f2;stroke:#999;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .relationshipLabelBox{fill:hsl(-160,0%,93.3333333333%);opacity:0.7;background-color:hsl(-160,0%,93.3333333333%);}#mermaid-svg-yzIyUUEk5ZAKuHzQ .relationshipLabelBox rect{opacity:0.5;}#mermaid-svg-yzIyUUEk5ZAKuHzQ .relationshipLine{stroke:#666;}#mermaid-svg-yzIyUUEk5ZAKuHzQ:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-yzIyUUEk5ZAKuHzQ er{fill:apa;}</style><g></g><defs><marker id="ONLY_ONE_START" refX="0" refY="9" markerWidth="18" markerHeight="18" orient="auto"><path stroke="gray" fill="none" d="M9,0 L9,18 M15,0 L15,18"></path></marker></defs><defs><marker id="ONLY_ONE_END" refX="18" refY="9" markerWidth="18" markerHeight="18" orient="auto"><path stroke="gray" fill="none" d="M3,0 L3,18 M9,0 L9,18"></path></marker></defs><defs><marker id="ZERO_OR_ONE_START" refX="0" refY="9" markerWidth="30" markerHeight="18" orient="auto"><circle stroke="gray" fill="white" cx="21" cy="9" r="6"></circle><path stroke="gray" fill="none" d="M9,0 L9,18"></path></marker></defs><defs><marker id="ZERO_OR_ONE_END" refX="30" refY="9" markerWidth="30" markerHeight="18" orient="auto"><circle stroke="gray" fill="white" cx="9" cy="9" r="6"></circle><path stroke="gray" fill="none" d="M21,0 L21,18"></path></marker></defs><defs><marker id="ONE_OR_MORE_START" refX="18" refY="18" markerWidth="45" markerHeight="36" orient="auto"><path stroke="gray" fill="none" d="M0,18 Q 18,0 36,18 Q 18,36 0,18 M42,9 L42,27"></path></marker></defs><defs><marker id="ONE_OR_MORE_END" refX="27" refY="18" markerWidth="45" markerHeight="36" orient="auto"><path stroke="gray" fill="none" d="M3,9 L3,27 M9,18 Q27,0 45,18 Q27,36 9,18"></path></marker></defs><defs><marker id="ZERO_OR_MORE_START" refX="18" refY="18" markerWidth="57" markerHeight="36" orient="auto"><circle stroke="gray" fill="white" cx="48" cy="18" r="6"></circle><path stroke="gray" fill="none" d="M0,18 Q18,0 36,18 Q18,36 0,18"></path></marker></defs><defs><marker id="ZERO_OR_MORE_END" refX="39" refY="18" markerWidth="57" markerHeight="36" orient="auto"><circle stroke="gray" fill="white" cx="9" cy="18" r="6"></circle><path stroke="gray" fill="none" d="M21,18 Q39,0 57,18 Q39,36 21,18"></path></marker></defs></svg></pre>
<h3 id="table-summary">8.2 Table Summary</h3>
<p>| Table | Purpose |</p>
<p>|-------|---------|</p>
<p>| <strong>users</strong> | Customers, agents; auth, roles |</p>
<p>| <strong>passengers</strong> | Saved traveler profiles |</p>
<p>| <strong>bookings</strong> | Order ref, PNR, status, amount, offer snapshot |</p>
<p>| <strong>booking_passengers</strong> | Junction: booking ↔ passenger |</p>
<p>| <strong>flight_segments</strong> | Itinerary per booking |</p>
<p>| <strong>payments</strong> | Payment ref, amount, status |</p>
<p>| <strong>refunds</strong> | Refund amount, status, date |</p>
<p>| <strong>logs</strong> | Audit trail, API requests |</p>
<hr>
<h2 id="security-best-practices">9. Security Best Practices</h2>
<p>| Area | Practice |</p>
<p>|------|----------|</p>
<p>| <strong>API keys</strong> | Store in secrets manager; rotate periodically; never in code/repo |</p>
<p>| <strong>PCI</strong> | Use Payment Intents or tokenization; avoid handling raw card data |</p>
<p>| <strong>GDPR</strong> | Encrypt PII; support deletion/export; document retention |</p>
<p>| <strong>Payments</strong> | Validate amounts server-side; use idempotency; verify webhook signatures |</p>
<p>| <strong>Rate limiting</strong> | Throttle by IP/user; respect Duffel limits |</p>
<p>| <strong>Fraud</strong> | AVS, 3DS where applicable; velocity checks; anomaly detection |</p>
<p>| <strong>TLS</strong> | Enforce HTTPS; TLS 1.2+ for all external calls |</p>
<p>| <strong>Auth</strong> | JWT/sessions; RBAC for agents/admins |</p>
<h3 id="webhook-signature-verification">9.1 Webhook Signature Verification</h3>
<p>Validate <code>Duffel-Signature</code> (or equivalent) header to ensure webhooks are from Duffel before processing.</p>
<hr>
<h2 id="error-handling--edge-cases">10. Error Handling &amp; Edge Cases</h2>
<p>| Scenario | Mitigation |</p>
<p>|----------|------------|</p>
<p>| <strong>Price change</strong> | Re-fetch offer before booking; show updated price; abort if changed significantly |</p>
<p>| <strong>Offer expired</strong> | Check <code>expires_at</code>; prompt user to search again |</p>
<p>| <strong>Payment failure</strong> | Retry with backoff; show clear error; do not create Duffel order |</p>
<p>| <strong>Airline rejection</strong> | Handle <code>order.failed</code>; log; notify user; offer alternative/search |</p>
<p>| <strong>API downtime</strong> | Circuit breaker; retry with backoff; show maintenance message |</p>
<p>| <strong>Partial failure</strong> | Idempotency keys; reconcile with Duffel support if needed |</p>
<p>| <strong>Webhook replay</strong> | Idempotent handlers; track processed event IDs |</p>
<h3 id="error-handling-flow">10.1 Error Handling Flow</h3>
<pre class=" language-mermaid"><svg id="mermaid-svg-uPX0Hg22QHFnE5zj" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="661.234375" style="max-width: 834.13671875px;" viewBox="0 0 834.13671875 661.234375"><style>#mermaid-svg-uPX0Hg22QHFnE5zj{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-uPX0Hg22QHFnE5zj .error-icon{fill:#552222;}#mermaid-svg-uPX0Hg22QHFnE5zj .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-uPX0Hg22QHFnE5zj .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-uPX0Hg22QHFnE5zj .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-uPX0Hg22QHFnE5zj .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-uPX0Hg22QHFnE5zj .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-uPX0Hg22QHFnE5zj .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-uPX0Hg22QHFnE5zj .marker{fill:#666;stroke:#666;}#mermaid-svg-uPX0Hg22QHFnE5zj .marker.cross{stroke:#666;}#mermaid-svg-uPX0Hg22QHFnE5zj svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-uPX0Hg22QHFnE5zj .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#000000;}#mermaid-svg-uPX0Hg22QHFnE5zj .cluster-label text{fill:#333;}#mermaid-svg-uPX0Hg22QHFnE5zj .cluster-label span{color:#333;}#mermaid-svg-uPX0Hg22QHFnE5zj .label text,#mermaid-svg-uPX0Hg22QHFnE5zj span{fill:#000000;color:#000000;}#mermaid-svg-uPX0Hg22QHFnE5zj .node rect,#mermaid-svg-uPX0Hg22QHFnE5zj .node circle,#mermaid-svg-uPX0Hg22QHFnE5zj .node ellipse,#mermaid-svg-uPX0Hg22QHFnE5zj .node polygon,#mermaid-svg-uPX0Hg22QHFnE5zj .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-svg-uPX0Hg22QHFnE5zj .node .label{text-align:center;}#mermaid-svg-uPX0Hg22QHFnE5zj .node.clickable{cursor:pointer;}#mermaid-svg-uPX0Hg22QHFnE5zj .arrowheadPath{fill:#333333;}#mermaid-svg-uPX0Hg22QHFnE5zj .edgePath .path{stroke:#666;stroke-width:1.5px;}#mermaid-svg-uPX0Hg22QHFnE5zj .flowchart-link{stroke:#666;fill:none;}#mermaid-svg-uPX0Hg22QHFnE5zj .edgeLabel{background-color:white;text-align:center;}#mermaid-svg-uPX0Hg22QHFnE5zj .edgeLabel rect{opacity:0.5;background-color:white;fill:white;}#mermaid-svg-uPX0Hg22QHFnE5zj .cluster rect{fill:hsl(210,66.6666666667%,95%);stroke:#26a;stroke-width:1px;}#mermaid-svg-uPX0Hg22QHFnE5zj .cluster text{fill:#333;}#mermaid-svg-uPX0Hg22QHFnE5zj .cluster span{color:#333;}#mermaid-svg-uPX0Hg22QHFnE5zj div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(-160,0%,93.3333333333%);border:1px solid #26a;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-uPX0Hg22QHFnE5zj:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-uPX0Hg22QHFnE5zj flowchart-v2{fill:apa;}</style><g transform="translate(0, 0)"><marker id="flowchart-pointEnd" class="marker flowchart" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-pointStart" class="marker flowchart" viewBox="0 0 10 10" refX="0" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-circleEnd" class="marker flowchart" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-circleStart" class="marker flowchart" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="flowchart-crossEnd" class="marker cross flowchart" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="flowchart-crossStart" class="marker cross flowchart" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path d="M589.69921875,33.796933165716L541.3209635416666,40.61723597143C492.9427083333333,47.437538777144,396.1861979166667,61.07814438857199,347.8912760416667,72.14844719428599C299.5963541666667,83.21875,299.7630208333333,91.71875,299.8463541666667,95.96875L299.9296875,100.21875" id="L-A-B" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M255.77071368642464,183.96602618642464L225.00554265535388,197.6357509886872C194.24037162428309,211.30547579094977,132.71002956214156,238.64492539547487,101.94485853107078,258.7078793644041C71.1796875,278.7708333333333,71.1796875,291.5572916666667,71.1796875,297.9505208333333L71.1796875,304.34375" id="L-B-C" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M288.44352516365973,216.6388376636597L286.54147930304975,224.8630938863831C284.63943344243984,233.0873501091065,280.8353417212199,249.53586255455323,278.9332958606099,264.1533479439433C277.03125,278.7708333333333,277.03125,291.5572916666667,277.03125,297.9505208333333L277.03125,304.34375" id="L-B-D" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-D" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M340.5614028237034,187.49328467629655L363.4151013114195,200.57513306358047C386.26879979913565,213.65698145086435,431.9761967745678,239.82067822543218,455.7083316972553,259.2957557793828C479.4404666199428,278.7708333333333,481.1973394898857,291.5572916666667,482.07577592485706,297.9505208333333L482.9542123598285,304.34375" id="L-B-E" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-E" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M350.12766785035353,177.9270196496465L403.9078221669613,192.60324554137208C457.687976483569,207.27947143309765,565.2482851167846,236.6319232165488,619.9068758683637,257.7013782749411C674.5654666199429,278.7708333333333,676.3223394898856,291.5572916666667,677.2007759248571,297.9505208333333L678.0792123598285,304.34375" id="L-B-F" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-F" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M551.9375,311.1091324453725L587.21875,303.58833953781044C622.5,296.06754663024833,693.0625,281.02596081512417,728.34375,256.45308457422874C763.625,231.88020833333334,763.625,197.77604166666666,763.625,165.8984375C763.625,134.02083333333334,763.625,104.36979166666667,746.3118489583334,83.82823851439392C728.9986979166666,63.28668536212117,694.3723958333334,51.85462072424233,677.0592447916666,46.138588405302926L659.74609375,40.42255608636351" id="L-E-A" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-A" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M680.9453125,346.0625L680.9453125,350.2291666666667C680.9453125,354.3958333333333,680.9453125,362.7291666666667,686.1755366830588,375.4995935252746C691.4057608661175,388.2700203838826,701.8662092322348,405.4775407677651,707.0964334152936,414.08130095970637L712.3266575983523,422.6850611516477" id="L-F-G" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-G" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M764.5717799016477,422.6850611516477L769.6353374180397,414.08130095970637C774.6988949344318,405.4775407677651,784.8260099672158,388.2700203838826,789.889567483608,372.0230310252746C794.953125,355.7760416666667,794.953125,340.4895833333333,794.953125,322.9765625C794.953125,305.4635416666667,794.953125,285.7239583333333,794.953125,258.8020833333333C794.953125,231.88020833333334,794.953125,197.77604166666666,794.953125,165.8984375C794.953125,134.02083333333334,794.953125,104.36979166666667,772.4186197916666,83.47356955184837C749.8841145833334,62.57734743703006,704.8151041666666,50.435944874060134,682.2805989583334,44.365243592575176L659.74609375,38.294542311090204" id="L-G-A" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-A" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M738.44921875,535.296875L738.3658854166666,541.6067708333334C738.2825520833334,547.9166666666666,738.1158854166666,560.5364583333334,738.0325520833334,573.2395833333334C737.94921875,585.9427083333334,737.94921875,598.7291666666666,737.94921875,605.1223958333334L737.94921875,611.515625" id="L-G-H" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path><path d="M277.03125,346.0625L277.03125,350.2291666666667C277.03125,354.3958333333333,277.03125,362.7291666666667,277.03125,379.1471354166667C277.03125,395.5651041666667,277.03125,420.0677083333333,277.03125,432.3190104166667L277.03125,444.5703125" id="L-D-I" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-I" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(71.1796875, 265.984375)"><g class="label" transform="translate(-12.2109375, -13.359375)"><foreignObject width="24.421875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">2xx</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(277.03125, 265.984375)"><g class="label" transform="translate(-12.2109375, -13.359375)"><foreignObject width="24.421875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">4xx</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(477.68359375, 265.984375)"><g class="label" transform="translate(-12.5859375, -13.359375)"><foreignObject width="25.171875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">429</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(672.80859375, 265.984375)"><g class="label" transform="translate(-12.2109375, -13.359375)"><foreignObject width="24.421875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">5xx</span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(794.953125, 265.984375)"><g class="label" transform="translate(-11.328125, -13.359375)"><foreignObject width="22.65625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">Yes</span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(737.94921875, 573.15625)"><g class="label" transform="translate(-9.3984375, -13.359375)"><foreignObject width="18.796875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">No</span></div></foreignObject></g></g><g class="edgeLabel"><g class="label" transform="translate(0, 0)"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default default" id="flowchart-A-1286" transform="translate(624.72265625, 28.859375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-35.0234375" y="-20.859375" width="70.046875" height="41.71875"></rect><g class="label" style="" transform="translate(-27.5234375, -13.359375)"><foreignObject width="55.046875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">API Call</span></div></foreignObject></g></g><g class="node default default" id="flowchart-B-1287" transform="translate(299.4296875, 163.671875)"><polygon points="63.953125,0 127.90625,-63.953125 63.953125,-127.90625 0,-63.953125" class="label-container" transform="translate(-63.953125,63.953125)" style=""></polygon><g class="label" style="" transform="translate(-35.59375, -13.359375)"><foreignObject width="71.1875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Response?</span></div></foreignObject></g></g><g class="node default default" id="flowchart-C-1289" transform="translate(71.1796875, 325.203125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-63.1796875" y="-20.859375" width="126.359375" height="41.71875"></rect><g class="label" style="" transform="translate(-55.6796875, -13.359375)"><foreignObject width="111.359375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Process Success</span></div></foreignObject></g></g><g class="node default default" id="flowchart-D-1291" transform="translate(277.03125, 325.203125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-92.671875" y="-20.859375" width="185.34375" height="41.71875"></rect><g class="label" style="" transform="translate(-85.171875, -13.359375)"><foreignObject width="170.34375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Log &amp; Return User Error</span></div></foreignObject></g></g><g class="node default default" id="flowchart-E-1293" transform="translate(485.8203125, 325.203125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-66.1171875" y="-20.859375" width="132.234375" height="41.71875"></rect><g class="label" style="" transform="translate(-58.6171875, -13.359375)"><foreignObject width="117.234375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Wait Retry-After</span></div></foreignObject></g></g><g class="node default default" id="flowchart-F-1295" transform="translate(680.9453125, 325.203125)"><rect class="basic label-container" style="" rx="0" ry="0" x="-79.0078125" y="-20.859375" width="158.015625" height="41.71875"></rect><g class="label" style="" transform="translate(-71.5078125, -13.359375)"><foreignObject width="143.015625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Exponential Backoff</span></div></foreignObject></g></g><g class="node default default" id="flowchart-G-1299" transform="translate(737.94921875, 465.4296875)"><polygon points="69.3671875,0 138.734375,-69.3671875 69.3671875,-138.734375 0,-69.3671875" class="label-container" transform="translate(-69.3671875,69.3671875)" style=""></polygon><g class="label" style="" transform="translate(-41.0078125, -13.359375)"><foreignObject width="82.015625" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Retries &lt; 3?</span></div></foreignObject></g></g><g class="node default default" id="flowchart-H-1303" transform="translate(737.94921875, 632.375)"><rect class="basic label-container" style="" rx="0" ry="0" x="-88.1875" y="-20.859375" width="176.375" height="41.71875"></rect><g class="label" style="" transform="translate(-80.6875, -13.359375)"><foreignObject width="161.375" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Alert &amp; Fail Gracefully</span></div></foreignObject></g></g><g class="node default default" id="flowchart-I-1305" transform="translate(277.03125, 465.4296875)"><rect class="basic label-container" style="" rx="0" ry="0" x="-55.4375" y="-20.859375" width="110.875" height="41.71875"></rect><g class="label" style="" transform="translate(-47.9375, -13.359375)"><foreignObject width="95.875" height="26.71875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="nodeLabel">Do NOT Retry</span></div></foreignObject></g></g></g></g></g></svg></pre>
<h3 id="recommended-retry-policy">10.2 Recommended Retry Policy</h3>
<ul>
<li>
<p><strong>5xx</strong>: Retry with exponential backoff (e.g., 1s, 2s, 4s, 8s; max 3 retries)</p>
</li>
<li>
<p><strong>429</strong>: Respect <code>Retry-After</code>; back off and retry</p>
</li>
<li>
<p><strong>4xx (client)</strong>: Do not retry; log and return user-facing error</p>
</li>
</ul>
<hr>
<h2 id="testing-strategy">11. Testing Strategy</h2>
<h3 id="sandbox-testing">11.1 Sandbox Testing</h3>
<p>| Area | Approach |</p>
<p>|------|----------|</p>
<p>| <strong>Duffel test mode</strong> | Use <code>duffel_test_</code> tokens; Duffel Airways for deterministic data |</p>
<p>| <strong>Mock data</strong> | Stub Duffel in unit tests; use fixtures for offers/orders |</p>
<p>| <strong>Integration tests</strong> | Hit Duffel sandbox; use test cards for payments |</p>
<p>| <strong>Webhooks</strong> | Use ngrok or similar to receive webhooks locally |</p>
<h3 id="qa-checklist">11.2 QA Checklist</h3>
<ul>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Search: one-way, round-trip, multi-city</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Offer selection and expiry handling</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Booking: single/multi passenger, validation errors</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Payment: success, failure, timeout</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Cancellation: refund quote, confirm, partial vs full</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Seat selection (where supported)</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Post-booking bags</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Webhook handling: order.created, payment.*, airline_initiated_change</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Error paths: expired offer, insufficient funds, airline rejection</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Admin: view booking, cancel, refund</p>
</li>
</ul>
<h3 id="load-testing">11.3 Load Testing</h3>
<ul>
<li>
<p>Simulate peak search volume</p>
</li>
<li>
<p>Measure search-to-book ratio</p>
</li>
<li>
<p>Verify cache effectiveness</p>
</li>
<li>
<p>Check database and Duffel latency under load</p>
</li>
</ul>
<hr>
<h2 id="deployment--production-readiness">12. Deployment &amp; Production Readiness</h2>
<h3 id="go-live-steps">12.1 Go-Live Steps</h3>
<p>| Step | Action |</p>
<p>|------|--------|</p>
<p>| 1 | Request live API access from Duffel |</p>
<p>| 2 | Replace test key with live key in production secrets |</p>
<p>| 3 | Verify webhook URLs are production HTTPS |</p>
<p>| 4 | Enable monitoring and alerting |</p>
<p>| 5 | Run smoke tests against live |</p>
<p>| 6 | Gradual rollout (e.g., percentage of traffic) |</p>
<h3 id="monitoring">12.2 Monitoring</h3>
<p>| Metric | Tool/Approach |</p>
<p>|--------|----------------|</p>
<p>| <strong>Uptime</strong> | Health checks to Duffel; status page |</p>
<p>| <strong>Latency</strong> | APM (e.g., New Relic, Datadog); p95, p99 |</p>
<p>| <strong>Errors</strong> | Log aggregation; alert on 5xx, high 4xx rate |</p>
<p>| <strong>Orders</strong> | Count, revenue, failure rate |</p>
<p>| <strong>Webhooks</strong> | Delivery success; retries; dead-letter handling |</p>
<h3 id="logging">12.3 Logging</h3>
<ul>
<li>
<p>Log request/response IDs, user ID, booking ID (no card data)</p>
</li>
<li>
<p>Structured logs (JSON) for querying</p>
</li>
<li>
<p>Retain per compliance (e.g., 90 days min)</p>
</li>
</ul>
<h3 id="alerts">12.4 Alerts</h3>
<ul>
<li>
<p>Duffel API errors (5xx, timeout)</p>
</li>
<li>
<p>Payment failures above threshold</p>
</li>
<li>
<p>Webhook delivery failures</p>
</li>
<li>
<p>Unusual order volume or refund rate</p>
</li>
</ul>
<h3 id="backup-strategy">12.5 Backup Strategy</h3>
<ul>
<li>
<p>Database backups (daily + point-in-time)</p>
</li>
<li>
<p>Configuration as code (IaC)</p>
</li>
<li>
<p>Document runbooks for incident response</p>
</li>
</ul>
<hr>
<h2 id="realistic-development-timeline">13. Realistic Development Timeline</h2>
<h3 id="mvp-integration-8–10-weeks">13.1 MVP Integration (8–10 weeks)</h3>
<p>| Phase | Duration | Focus |</p>
<p>|-------|----------|-------|</p>
<p>| Phase 1–2 | 1 week | Account, backend setup, auth |</p>
<p>| Phase 3 | 2 weeks | Search integration, caching, UI |</p>
<p>| Phase 4–5 | 2–3 weeks | Booking + payment |</p>
<p>| Phase 6 | 1 week | Confirmation, PNR, emails |</p>
<p>| Phase 7 | 1–2 weeks | Cancellation, refunds |</p>
<p>| Phase 8 | 1 week | Basic admin, reporting |</p>
<h3 id="full-production-system-16–20-weeks">13.2 Full Production System (16–20 weeks)</h3>
<p>Includes MVP plus: agent portal, corporate policies, advanced admin, reporting, performance tuning, security review.</p>
<h3 id="team-roles">13.3 Team Roles</h3>
<p>| Role | Responsibility |</p>
<p>|------|----------------|</p>
<p>| <strong>Backend</strong> | API, Duffel integration, DB, payments |</p>
<p>| <strong>Frontend</strong> | Web + mobile UI |</p>
<p>| <strong>DevOps</strong> | Infra, CI/CD, monitoring |</p>
<p>| <strong>QA</strong> | Test automation, regression |</p>
<p>| <strong>Product</strong> | Requirements, prioritization |</p>
<h3 id="effort-estimate-by-phase">13.4 Effort Estimate by Phase</h3>
<p>| Phase | Dev Days | Notes |</p>
<p>|-------|----------|-------|</p>
<p>| 1–2 | 5 | Setup, secrets, HTTP client |</p>
<p>| 3 | 10 | Search, filters, cache |</p>
<p>| 4–5 | 15 | Order creation, validation, payment |</p>
<p>| 6 | 5 | Confirmation, notifications |</p>
<p>| 7 | 10 | Cancel, refund, support flows |</p>
<p>| 8 | 8 | Admin CRUD, basic reports |</p>
<p>| <strong>Total MVP</strong> | <strong>~53</strong> | 1 FTE ≈ 10–11 weeks |</p>
<hr>
<h2 id="scaling-considerations">14. Scaling Considerations</h2>
<p>| Aspect | Approach |</p>
<p>|--------|----------|</p>
<p>| <strong>Traffic</strong> | Horizontal scaling of API; CDN for static assets |</p>
<p>| <strong>Search</strong> | Caching (Redis); stay within 1500:1 ratio; consider pre-cache for popular routes |</p>
<p>| <strong>Database</strong> | Read replicas; connection pooling; indexes on booking/date |</p>
<p>| <strong>Duffel</strong> | Respect rate limits; batch where possible; queue for async work |</p>
<p>| <strong>Microservices</strong> | Split search, booking, payment, notifications as load grows |</p>
<p>| <strong>Multi-region</strong> | DB replication; regional API; consider Duffel latency by region |</p>
<hr>
<h2 id="cost-factors--business-considerations">15. Cost Factors &amp; Business Considerations</h2>
<h3 id="duffel-api-costs-basic">15.1 Duffel API Costs (Basic)</h3>
<p>| Item | Cost |</p>
<p>|------|------|</p>
<p>| Orders | $3.00 per confirmed order |</p>
<p>| Managed content | 1% of order value |</p>
<p>| Ancillaries | $2.00 per paid ancillary |</p>
<p>| Excess search | $0.005 per search above 1500:1 |</p>
<p>| FX | 2% on conversions |</p>
<h3 id="agency-revenue-model">15.2 Agency Revenue Model</h3>
<ul>
<li>
<p><strong>Markup</strong>: Add margin on airfare (e.g., 5–15%)</p>
</li>
<li>
<p><strong>Service fee</strong>: Flat or percentage per booking</p>
</li>
<li>
<p><strong>Agent commission</strong>: B2B commission split</p>
</li>
<li>
<p><strong>Ancillary margin</strong>: Mark up bags, seats</p>
</li>
</ul>
<h3 id="commission-handling">15.3 Commission Handling</h3>
<ul>
<li>
<p>Track commission per agent/booking</p>
</li>
<li>
<p>Settle periodically (weekly/monthly)</p>
</li>
<li>
<p>Integrate with accounting system</p>
</li>
</ul>
<hr>
<h2 id="future-enhancements">16. Future Enhancements</h2>
<p>| Enhancement | Description |</p>
<p>|-------------|-------------|</p>
<p>| <strong>Multi-supplier</strong> | Add Amadeus, Skyscanner, etc., for coverage/comparison |</p>
<p>| <strong>Hotels &amp; cars</strong> | Duffel Stays; car rental APIs |</p>
<p>| <strong>Loyalty</strong> | Frequent-flyer enrollment; loyalty points |</p>
<p>| <strong>AI recommendations</strong> | Personalization, upsell, rebooking |</p>
<p>| <strong>Chatbot</strong> | Search and support via chat |</p>
<p>| <strong>White-label</strong> | Reseller/white-label for agencies |</p>
<hr>
<h2 id="final-integration-checklist">17. Final Integration Checklist</h2>
<h3 id="pre-development">Pre-Development</h3>
<ul>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Duffel account created</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Test API key obtained</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Sandbox access verified</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Team trained on Duffel docs</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Environment variables configured</p>
</li>
</ul>
<h3 id="development">Development</h3>
<ul>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Offers API integrated with caching</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Orders API integrated with validation</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Payment flow (Intent or gateway) working</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Webhooks configured and verified</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Cancellation and refund flows implemented</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Error handling and retries in place</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Logging and monitoring added</p>
</li>
</ul>
<h3 id="pre-production">Pre-Production</h3>
<ul>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Live API key obtained and stored securely</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Production webhook URL configured</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> SSL/TLS verified</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Load testing completed</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Security review done</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Runbooks documented</p>
</li>
</ul>
<h3 id="go-live">Go-Live</h3>
<ul>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Smoke tests passed on live</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Monitoring and alerts active</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Support process defined</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Rollback plan documented</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Stakeholders notified</p>
</li>
</ul>
<h3 id="post-launch">Post-Launch</h3>
<ul>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Monitor error rates and latency</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Track search-to-book ratio</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Review refund and cancellation patterns</p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" disabled=""> Optimize cache and performance as needed</p>
</li>
</ul>
<hr>
<h2 id="document-control">Document Control</h2>
<p>| Version | Date | Author | Changes |</p>
<p>|---------|------|--------|---------|</p>
<p>| 1.0 | Feb 2026 | Technical Team | Initial release |</p>
<hr>
<p><em>This document is intended for internal technical and product teams. For the latest Duffel API details, refer to <a href="https://duffel.com/docs">duffel.com/docs</a>.</em></p>

